# 概念配置指南

本文档说明如何维护概念定义和股票-概念关系。

## 配置文件位置

```
skills/dragon-stock-trading/data/concepts.json
```

---

## 一、概念定义（concepts.json）

### 用途

`concepts.json` **只存储概念的定义**（层级结构、描述），不存储股票关联关系。

### 格式（层级结构）

```json
{
  "大类名称": {
    "category": "所属类别",
    "description": "大类描述",
    "subconcepts": {
      "细分概念1": {
        "description": "细分概念描述",
        "keywords": ["关键词1", "关键词2"]
      }
    }
  }
}
```

### 字段说明

- **大类名称**: 顶层概念分类（如"商业航天"、"化工"、"新能源"）
- **category**: 所属类别标签（如"军工"、"基础材料"、"能源"）
- **description**: 该大类或细分概念的描述
- **subconcepts**: 该大类下的细分概念字典
- **keywords**: 该细分概念的关键词（用于识别）

### 示例

```json
{
  "商业航天": {
    "category": "军工",
    "description": "商业航天产业链相关概念",
    "subconcepts": {
      "商业航天": {
        "description": "商业火箭发射、卫星制造等",
        "keywords": ["火箭", "卫星", "航天器", "商业航天"]
      }
    }
  },
  "化工": {
    "category": "基础材料",
    "description": "化工行业细分领域",
    "subconcepts": {
      "磷化工": {
        "description": "磷矿开采、磷酸生产等",
        "keywords": ["磷矿", "磷酸", "磷肥", "磷化工"]
      },
      "氟化工": {
        "description": "氟化物、制冷剂生产等",
        "keywords": ["氟化物", "制冷剂", "氟化工"]
      }
    }
  }
}
```

### 维护方式

**添加新大类**：
```json
{
  "新能源": {
    "category": "能源",
    "description": "新能源技术及产业链",
    "subconcepts": {
      "HJT电池": {
        "description": "异质结太阳能电池技术",
        "keywords": ["HJT", "异质结", "太阳能电池"]
      }
    }
  }
}
```

**添加细分概念**：
```json
{
  "化工": {
    "category": "基础材料",
    "description": "化工行业细分领域",
    "subconcepts": {
      "磷化工": {...},
      "氟化工": {...},
      "硅化工": {
        "description": "有机硅、硅橡胶生产",
        "keywords": ["有机硅", "硅橡胶", "硅化工"]
      }
    }
  }
}
```

---

## 二、股票-概念关系（stock_concept 表）

### 用途

股票与概念的关联关系**直接在数据库中维护**，不通过 JSON 配置。

### 数据库表结构

```sql
CREATE TABLE stock_concept (
    stock_code TEXT,
    concept_name TEXT,
    is_core INTEGER,  -- 1=核心标的, 0=相关标的
    note TEXT,        -- 备注（如：大类/细分路径）
    PRIMARY KEY (stock_code, concept_name)
);
```

### 维护方式

#### 方法1：使用维护脚本（推荐）

```bash
# 编辑 scripts/stock_concept_manager.py
# 在 main() 函数中添加或修改股票-概念关系

python scripts/stock_concept_manager.py
```

**示例代码**：
```python
# 批量添加商业航天概念的股票
commercial_space_stocks = [
    ('002025', '商业航天', True, '商业航天/商业航天'),   # 核心
    ('688122', '商业航天', True, '商业航天/商业航天'),   # 核心
    ('300416', '商业航天', False, '商业航天/商业航天'),  # 相关
]
manager.batch_add_stocks(commercial_space_stocks)
```

#### 方法2：直接使用 SQL

```bash
sqlite3 data/dragon_stock.db
```

**添加关系**：
```sql
INSERT OR REPLACE INTO stock_concept 
(stock_code, concept_name, is_core, note)
VALUES 
('002025', '商业航天', 1, '商业航天/商业航天'),
('688122', '商业航天', 1, '商业航天/商业航天');
```

**删除关系**：
```sql
DELETE FROM stock_concept 
WHERE stock_code = '002025' AND concept_name = '商业航天';
```

**查看概念下的股票**：
```sql
SELECT stock_code, is_core, note 
FROM stock_concept 
WHERE concept_name = '商业航天'
ORDER BY is_core DESC;
```

**查看股票的所有概念**：
```sql
SELECT concept_name, is_core, note 
FROM stock_concept 
WHERE stock_code = '002025';
```

---

## 三、设计原则

### concepts.json 的设计原则

1. **只存储需要经常看和变更的信息**
   - 概念层级结构（大类、细分）
   - 概念描述
   - 关键词

2. **不存储频繁变化的数据**
   - ❌ 不存储股票代码
   - ❌ 不存储股票与概念的关联

3. **keywords 应该是细分领域**
   - ✅ "磷矿"、"磷酸"、"HJT"、"异质结"
   - ❌ "化工"、"新能源"（太宽泛）

### stock_concept 表的设计原则

1. **灵活维护**
   - 可以随时添加/删除股票与概念的关联
   - 可以通过脚本批量操作
   - 可以直接用 SQL 修改

2. **区分核心和相关**
   - `is_core = 1`: 核心标的（业务主营相关）
   - `is_core = 0`: 相关标的（业务涉及但非主营）

3. **记录路径**
   - `note` 字段存储完整路径（如"商业航天/商业航天"）
   - 便于追溯概念归属

---

## 四、常见问题

### Q: 为什么要分离概念定义和股票关联？

A: 
- **概念定义相对稳定**：概念层级和描述不常变
- **股票关联频繁变化**：根据市场热点需要经常调整
- **分离后更灵活**：可以用脚本或 SQL 快速维护股票关联

### Q: 如何添加新概念和新股票？

A: 
1. 先在 `concepts.json` 中定义概念（大类、细分、关键词）
2. 再用脚本或 SQL 将股票添加到 `stock_concept` 表

### Q: 一只股票可以属于多个概念吗？

A: 可以。在 `stock_concept` 表中插入多条记录即可。

### Q: 如何查看当前的概念定义？

A: `cat data/concepts.json`

### Q: 如何查看当前的股票-概念关系？

A: 
```bash
sqlite3 data/dragon_stock.db "SELECT * FROM stock_concept;"
```
或运行 `python scripts/stock_concept_manager.py`

---

## 五、维护建议

### 定期维护概念定义
- **月度**: 新增当月出现的新概念
- **季度**: 调整概念分类和描述

### 触发式维护股票关系
- **市场热点出现** → 立即添加相关股票
- **龙头股异动** → 检查其概念归属
- **个股逻辑变化** → 调整核心/相关分类

### 质量控制
- 修改后运行测试验证
- 定期检查概念归属是否合理
- 与市场主流观点对比校准

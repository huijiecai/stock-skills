# Investment Analysis Skill - 完整工作流程

> **核心目标**：通过系统化的行业分析和公司分析，自动构建和维护概念股票池体系

---

## 一、整体流程图

```
用户输入："分析有色金属行业"
          ↓
┌─────────────────────────────────────────────────┐
│  阶段1: 行业分析 (40-60分钟)                     │
├─────────────────────────────────────────────────┤
│  1. 确认行业范围                                 │
│  2. 收集行业信息（市场规模、产业链、龙头企业）    │
│  3. 生成行业报告（25-40家公司列表）              │
│  4. 保存到 docs/有色金属/00_行业概览.md          │
└─────────────────────────────────────────────────┘
          ↓ 自动触发
┌─────────────────────────────────────────────────┐
│  阶段2: 批量公司分析 (并行执行)                  │
├─────────────────────────────────────────────────┤
│  提取行业报告中的公司列表（30家）                │
│  ├─ Batch 1: 第一梯队 (7家) - 并行4个Task        │
│  ├─ Batch 2: 第二梯队 (15家) - 并行4个Task       │
│  └─ Batch 3: 第三梯队 (8家) - 并行4个Task        │
│                                                  │
│  每个Task执行：                                   │
│  - 信息收集（官网、年报、研报）                   │
│  - 生成公司报告                                   │
│  - 保存到 docs/有色金属/[细分领域]/公司名.md     │
│                                                  │
│  输出：30个公司分析报告                          │
└─────────────────────────────────────────────────┘
          ↓ 自动触发
┌─────────────────────────────────────────────────┐
│  阶段3: 概念池更新                               │
├─────────────────────────────────────────────────┤
│  把本次分析的30家公司批量添加到概念池             │
│                                                  │
│  对每家公司：                                     │
│  1. 确定概念归属（有色金属 → 黄金/稀土/锂等）     │
│  2. 判定核心/相关标的（基于市占率、营收占比）     │
│  3. 提取归属逻辑（从公司报告的行业地位章节）      │
│                                                  │
│  批量更新 docs/概念股票池体系.md：               │
│  - 找到对应概念章节                              │
│  - 添加股票行到表格                              │
│  - 填写：代码、名称、类型、逻辑、来源、状态       │
│                                                  │
│  输出：30家新增股票加入概念池                     │
└─────────────────────────────────────────────────┘
          ↓
┌─────────────────────────────────────────────────┐
│  最终产出                                        │
├─────────────────────────────────────────────────┤
│  ✅ 行业报告：1份 (00_行业概览.md)               │
│  ✅ 公司报告：30份 (分布在9个子目录)              │
│  ✅ 概念池新增：+30只股票                        │
│      ├─ 有色金属/黄金：+3只                      │
│      ├─ 有色金属/稀土：+4只                      │
│      ├─ 有色金属/锂业：+3只                      │
│      └─ ...                                     │
└─────────────────────────────────────────────────┘
```

---

## 二、三个核心组件

### 2.1 行业分析模块

**输入**：行业名称（如"有色金属"）

**处理流程**：
1. **信息收集**（40-60分钟）
   - 市场规模、产业链、竞争格局
   - **关键！穷举细分领域的上市公司**
     - 铜 → 搜索"铜矿开采 A股上市公司"
     - 铝 → 搜索"铝冶炼 A股上市公司"
     - 稀土 → 搜索"稀土 A股上市公司"
     - 锂 → 搜索"锂矿 A股上市公司"
     - ...（确保每个细分领域都覆盖）

2. **质量检查**（确保完整性）
   - ✅ 细分领域完整性（每个领域都有代表公司）
   - ✅ 梯队完整性（龙头、二线、潜力）
   - ✅ 市值覆盖度（市值前10都包含吗？）
   - ✅ 产业链完整性（上中下游都有）

3. **生成报告**
   - 使用 `templates/industry-template.md`
   - 核心章节：**A股投资标的全景**（25-40家公司）
   - 按梯队分类 + 按细分领域分类

**输出**：
- `docs/[行业]/00_行业概览.md`（含25-40家公司列表）
- 公司列表（JSON格式，供下游使用）

---

### 2.2 批量公司分析模块

**输入**：公司列表（从行业分析提取）

**处理流程**：
1. **分批并行**
   ```
   公司列表(30家) → 分成3批
   ├─ Batch 1: 龙头7家 → 4个并行Task
   ├─ Batch 2: 重要15家 → 4个并行Task  
   └─ Batch 3: 潜力8家 → 4个并行Task
   ```

2. **每个Task执行标准公司分析**
   - 信息收集（官网、年报、研报、财务数据）
   - 生成报告（使用 `templates/company-template.md`）
   - 保存到 `docs/[行业]/[细分领域]/[公司名].md`

3. **进度跟踪**
   - 实时显示完成进度（7/30）
   - 记录失败任务，供后续重试
   - 更新行业报告中的链接

**输出**：
- 30个公司分析报告（.md文件）
- 公司-概念映射数据（供概念池更新使用）

---

### 2.3 概念池更新模块

**核心目标**：把本次行业分析产出的30家公司，批量添加到概念股票池体系中

**输入**：
- 30家公司的分析报告（从阶段2产出）
- 行业→概念的映射规则

**处理流程**：

1. **提取公司数据**
   从30份公司报告中提取：
   ```json
   {
     "code": "601899",
     "name": "紫金矿业",
     "sub_sector": "铜+黄金",
     "market_share": "全球前五",
     "revenue_ratio": "铜业务占比60%+",
     "tech_advantage": "海外资源丰富，产能持续扩张"
   }
   ```

2. **判定标的类型**
   对每家公司判定核心/相关：
   - ✅ **核心标的**：市占率前3 + 营收占比>50% + 技术壁垒
   - ⚪ **相关标的**：不满足核心标的条件

3. **确定概念归属 + 细分领域**
   根据映射规则：
   ```
   有色金属行业 → 概念池
   ├─ 铜相关(5家)        → 概念:"工业金属"  细分领域:"铜"
   ├─ 铝相关(3家)        → 概念:"工业金属"  细分领域:"铝"
   ├─ 黄金(3家)          → 概念:"黄金"      细分领域:"黄金"
   ├─ 稀土(4家)          → 概念:"稀土"      细分领域:"稀土"
   └─ 锂业(3家)          → 概念:"锂业"      细分领域:"锂矿+锂盐"
   
   多业务公司：
   ├─ 紫金矿业(铜+黄金)  → 概念:"黄金"      细分领域:"铜+黄金"
   └─ 厦门钨业(钨+稀土)  → 概念:"工业金属"  细分领域:"钨+稀土"
   ```

4. **生成归属逻辑**（50字以内）
   从公司报告提取核心信息：
   ```
   紫金矿业 → "全球矿业航母，铜金双龙头，2026年产铜120万吨"
   北方稀土 → "全球稀土龙头，市占率69.9%，磁材产能9.5万吨"
   ```

5. **批量更新文档**
   在 `docs/概念股票池体系.md` 中：
   - 找到"有色金属/黄金"章节
   - 在表格中添加新行：
     ```markdown
     | 601899 | 紫金矿业 | 铜+黄金 | ✅ 核心标的 | 全球矿业航母，铜金双龙头 | 行业分析+公司报告 | ✅ 已验证 |
     ```
   - 更新概念说明：**细分领域**: 黄金开采与冶炼
   - 更新概念统计（股票数、核心标的数）

**输出**：
- 更新后的 `docs/概念股票池体系.md`（+30只股票）
- 更新日志：
  ```
  ✅ 有色金属板块更新完成：
  - 黄金概念：+3只（紫金矿业[铜+黄金]、山东黄金[黄金]、中金黄金[黄金]）
  - 稀土概念：+4只（北方稀土[稀土]、盛和资源[稀土]、中国稀土[稀土]、广晟有色[稀土]）
  - 锂业概念：+3只（天齐锂业[锂矿+锂盐]、赣锋锂业[锂矿+锂盐]、盛新锂能[锂盐]）
  - 工业金属：+20只（铜、铝、钴镍、钨钼、锌铅、锡等）
  ```

---

## 三、自动化执行策略

### 3.1 完全自动化模式（推荐）

```
用户："分析有色金属行业"
          ↓
阶段1: 行业分析（自动）
          ↓
阶段2: 批量公司分析（自动，提示用户"即将分析30家公司，预计1小时"）
          ↓
阶段3: 概念池更新（需用户确认批量更新）
          ↓
最终输出："✅ 有色金属行业分析完成：1份行业报告 + 30份公司报告 + 30只股票加入概念池"
```

### 3.2 分步确认模式（可选）

```
用户："分析有色金属行业"
          ↓
阶段1: 行业分析（自动）
          ↓
提示："行业分析完成，识别出30家公司。是否继续批量分析？"
用户确认 → 阶段2执行
          ↓
提示："30家公司分析完成。是否更新概念池？"
用户确认 → 阶段3执行
```

---

## 四、当前skill需要优化的点

### 4.1 行业分析模块 ✅ 已优化
- ✅ 细分领域穷举搜索策略
- ✅ 质量检查清单（替代固定数量）
- ✅ 三层级分类 + 细分领域分类

### 4.2 批量公司分析模块 ⚠️ 需完善

**当前问题**：
- 步骤5提到"触发公司批量分析（自动）"，但执行细节不够清晰
- 没有明确说明如何从行业报告提取公司列表
- 没有说明如何处理分析失败的公司

**需要补充**：
1. **公司列表提取逻辑**
   ```python
   # 伪代码
   companies = extract_companies_from_industry_report(
       report_path="docs/有色金属/00_行业概览.md",
       sections=["第一梯队", "第二梯队", "第三梯队"]
   )
   # 输出: [{"code": "601899", "name": "紫金矿业", "tier": 1}, ...]
   ```

2. **批次分配策略**
   - 优先分析龙头企业（第一梯队）
   - 每批最多4个并行Task
   - 每批之间间隔2-3分钟（避免API限流）

3. **失败处理机制**
   - 记录失败公司到 `failed_companies.json`
   - 最后统一重试失败的公司
   - 如果仍失败，生成待办清单

### 4.3 概念池更新模块 ⚠️ 需完善

**当前问题**：
- 步骤6提到"自动执行概念池更新"，但与第三章"概念池体系更新"的内容有重复
- 没有明确说明行业→概念的映射规则
- 没有说明如何处理一个公司归属多个概念的情况

**需要补充**：
1. **行业-概念映射表**
   ```yaml
   industry_concept_mapping:
     有色金属:
       primary: "有色金属"
       sub_concepts:
         - 黄金: ["紫金矿业", "山东黄金", "中金黄金"]
         - 稀土: ["北方稀土", "盛和资源"]
         - 锂业: ["天齐锂业", "赣锋锂业"]
     半导体:
       primary: "半导体"
       sub_concepts:
         - 设备: ["北方华创", "中微公司"]
         - 设计: ["韦尔股份", "兆易创新"]
   ```

2. **批量更新API**
   ```python
   # 伪代码
   batch_update_concept_pool(
       companies=[...],
       concept_mapping=mapping,
       auto_confirm=False  # 默认需要用户确认
   )
   ```

3. **多概念归属处理**
   - 一个公司可以归属多个概念
   - 每个概念独立判定核心/相关
   - 在归属逻辑中说明不同业务

---

## 五、完整示例（有色金属行业）

### 输入
```
用户："分析有色金属行业"
```

### 执行过程

**阶段1: 行业分析（45分钟）**
```
1. 搜索行业信息
   - "有色金属 市场规模 2025"
   - "有色金属 产业链 龙头企业"
   
2. 穷举细分领域公司
   - "铜矿开采 A股上市公司" → 紫金矿业、江西铜业、云南铜业...
   - "稀土 A股上市公司" → 北方稀土、盛和资源、中国稀土...
   - "锂矿 A股上市公司" → 天齐锂业、赣锋锂业...
   - ...
   
3. 质量检查
   ✅ 细分领域完整性：9个细分领域都有代表
   ✅ 梯队完整性：第一梯队7家、第二梯队15家、第三梯队8家
   ✅ 市值覆盖度：市值前10都包含
   
4. 生成报告
   保存到: docs/有色金属/00_行业概览.md
   包含: 30家公司列表（按梯队+细分领域分类）
```

**阶段2: 批量公司分析（1小时）**
```
提示用户："行业分析完成，识别出30家公司，即将批量分析（预计1小时）"

1. 提取公司列表
   [紫金矿业, 江西铜业, 北方稀土, 天齐锂业, ...] (30家)

2. 分批并行分析
   Batch 1 (龙头7家):
   ├─ Task 1: 紫金矿业 → docs/有色金属/铜/紫金矿业.md ✅
   ├─ Task 2: 江西铜业 → docs/有色金属/铜/江西铜业.md ✅
   ├─ Task 3: 北方稀土 → docs/有色金属/稀土/北方稀土.md ✅
   └─ Task 4: 天齐锂业 → docs/有色金属/锂/天齐锂业.md ✅
   
   进度: 7/30 完成
   
   Batch 2 (重要15家): ...
   Batch 3 (潜力8家): ...
   
3. 更新行业报告链接
   将 [待生成] 替换为 [📄 查看详情](./铜/紫金矿业.md)
```

**阶段3: 概念池更新**
```
1. 从30份公司报告提取信息
   - 股票代码、名称
   - 主营业务、市占率
   - 判定核心/相关标的

2. 生成更新预览
   提示用户："分析完成，建议将30家公司加入概念池：
   
   【有色金属/黄金】(3只)
   - 601899 紫金矿业 [铜+黄金] (核心) - 全球矿业航母，铜金双龙头
   - 600547 山东黄金 [黄金] (核心) - 国内黄金龙头，净利增56%-66%
   - 600489 中金黄金 [黄金] (核心) - 央企黄金平台
   
   【有色金属/稀土】(4只)
   - 600111 北方稀土 [稀土] (核心) - 全球稀土龙头，市占率69.9%
   - 600392 盛和资源 [稀土] (核心) - 六大稀土集团之一
   - 000831 中国稀土 [稀土] (核心) - 中重稀土龙头
   - 600259 广晟有色 [稀土] (核心) - 左坑矿全国最大
   
   ...（共30只）
   
   是否确认批量更新？[确认] / [修改] / [取消]"

3. 用户确认后批量更新
   - 更新 docs/概念股票池体系.md
   - 在各概念章节添加股票行
   - 更新统计数据（+30只股票）
```

### 最终输出
```
✅ 有色金属行业分析完成！

📊 生成内容：
├─ 行业报告：1份
│   └─ docs/有色金属/00_行业概览.md
│
├─ 公司报告：30份
│   ├─ 铜/ (5家)
│   ├─ 铝/ (3家)
│   ├─ 稀土/ (4家)
│   ├─ 锂/ (3家)
│   ├─ 钴镍/ (4家)
│   ├─ 黄金/ (3家)
│   ├─ 锌铅/ (3家)
│   ├─ 钨钼/ (4家)
│   └─ 锡/ (1家)
│
└─ 概念池更新：+30只股票
    ├─ 有色金属/黄金：+3只
    ├─ 有色金属/稀土：+4只
    ├─ 有色金属/锂业：+3只
    ├─ 有色金属/铜：+5只
    └─ ...（分布在9个概念）

📈 概念股票池体系的应用：
- 龙头战法选股：从有色金属概念中筛选核心标的
- 行业轮动跟踪：监控有色板块整体动向
- 个股深度研究：查阅30份详细公司报告
```

---

## 六、下一步行动

### 立即行动项

1. **优化 SKILL.md**
   - [ ] 补充阶段2的详细执行逻辑（公司列表提取、批次分配、失败处理）
   - [ ] 补充阶段3的映射规则和批量更新API说明
   - [ ] 整合第二章步骤5-6和第三章的内容，避免重复

2. **创建工具函数文档**
   - [ ] `reference/batch-analysis-guide.md` - 批量分析详细指南
   - [ ] `reference/concept-mapping-rules.md` - 行业-概念映射规则

3. **测试完整流程**
   - [ ] 选择一个新行业（如"化工"）
   - [ ] 执行完整流程（行业分析→公司分析→概念池更新）
   - [ ] 记录问题和优化点

### 长期优化

- [ ] 开发自动化脚本辅助批量操作
- [ ] 建立概念池数据库（结构化存储）
- [ ] 定期审核和更新概念池（季度/年度）

---

**文档版本**: v1.0
**更新日期**: 2026-02-27

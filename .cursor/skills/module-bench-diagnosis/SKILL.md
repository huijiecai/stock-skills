---
name: /module-bench-diagnosis
id: module-bench-diagnosis
category: testingTools
description: è¯Šæ–­ Module Bench æ€§èƒ½æµ‹è¯• Job çš„å¤±è´¥åŸå› ã€‚æ”¯æŒä» GitLab job URL è‡ªåŠ¨æå–æ—¥å¿—ï¼Œåˆ†æ Task Node Summary å’Œ Stage Summary Reportï¼Œå®šä½å¤±è´¥çš„ä»»åŠ¡å’Œé˜¶æ®µï¼Œæä¾›é”™è¯¯åŸå› åˆ†æã€‚å½“ç”¨æˆ·æä¾› module-bench ç›¸å…³çš„ GitLab job URL æˆ–æµ‹è¯•å¤±è´¥æ—¥å¿—æ—¶ä½¿ç”¨æ­¤ skillã€‚
---

# Module Bench æµ‹è¯•è¯Šæ–­

å¯¹ Module Bench æ€§èƒ½æµ‹è¯• Job è¿›è¡Œæ™ºèƒ½è¯Šæ–­ï¼Œå®šä½å¤±è´¥ä»»åŠ¡å’ŒåŸå› ã€‚

---

## ğŸ”„ æ ‡å‡†åŒ–è¯Šæ–­æµç¨‹ï¼ˆ6 æ­¥ï¼‰

**âš ï¸ å¿…é¡»ä¸¥æ ¼æŒ‰ä»¥ä¸‹ 6 ä¸ªæ­¥éª¤é¡ºåºæ‰§è¡Œï¼Œæ¯æ­¥éƒ½æœ‰å›ºå®šçš„å‘½ä»¤å’Œè¾“å‡ºæ ¼å¼ï¼**

**ğŸ“š çŸ¥è¯†åº“é˜…è¯»è¦æ±‚ï¼šåœ¨æ‰§è¡Œ Step 2-5 ä¹‹å‰ï¼Œå¿…é¡»å…ˆé˜…è¯» `knowledge/` ç›®å½•ä¸‹å¯¹åº”çš„çŸ¥è¯†åº“æ–‡ä»¶ï¼**

**ğŸš¨ æ—¥å¿—æå–å¼ºåˆ¶è¦æ±‚ï¼ˆé¿å…æ··æ·†æ•°æ®ï¼‰**ï¼š
- **æ¯ä¸ª Stage å¿…é¡»å•ç‹¬æå–æ—¥å¿—**ï¼šæ‰§è¡Œ Step 4.x æˆ– Step 5 æ—¶ï¼Œå¿…é¡»å…ˆæ‰§è¡Œ Step X.0 æå–è¯¥ Stage çš„æ—¥å¿—åˆ°ç‹¬ç«‹çš„ä¸´æ—¶æ–‡ä»¶
- **ç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­ç›´æ¥æœç´¢**ï¼šæ‰€æœ‰åˆ†æéƒ½å¿…é¡»åœ¨æå–å‡ºçš„ä¸´æ—¶æ–‡ä»¶ä¸­è¿›è¡Œ
- **ç¦æ­¢è·¨ Stage æ··ç”¨ä¸´æ—¶æ–‡ä»¶**ï¼šPerformance ç”¨ `/tmp/performance.txt`ï¼ŒEVALUATION ç”¨ `/tmp/eval_section.txt`ï¼Œä¸èƒ½æ··ç”¨
- **ç¦æ­¢è·³è¿‡ Step X.0**ï¼šå³ä½¿ä½ è®¤ä¸ºå¯ä»¥ç›´æ¥æœç´¢ï¼Œä¹Ÿå¿…é¡»å…ˆæå–æ—¥å¿—è¾¹ç•Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Module Bench è¯Šæ–­æµç¨‹å›¾                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Step 1: ä»»åŠ¡ç»Ÿè®¡                                                        â”‚
â”‚    â†“                                                                    â”‚
â”‚  Step 2: å¤±è´¥ä»»åŠ¡åˆ†æ (node_ret_codes)  ğŸ“š å¿…è¯»: task-status-codes.md    â”‚
â”‚    â†“                                                                    â”‚
â”‚  Step 3: Stage çŠ¶æ€æ£€æŸ¥                                                  â”‚
â”‚    â†“                                                                    â”‚
â”‚  Step 4: å¤±è´¥ Stage æ·±å…¥åˆ†æ (ä»…åˆ†æfailed)  ğŸ“š å¿…è¯»: å¯¹åº”çš„åˆ†æçŸ¥è¯†åº“    â”‚
â”‚          ğŸš¨ æ¯ä¸ª Stage å¿…é¡»æ‰§è¡Œ Step 4.x.0 æå–æ—¥å¿—åˆ°ç‹¬ç«‹æ–‡ä»¶            â”‚
â”‚          ğŸš¨ ç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­ç›´æ¥æœç´¢                                      â”‚
â”‚          ğŸš¨ ç¦æ­¢è·¨ Stage æ··ç”¨ä¸´æ—¶æ–‡ä»¶                                     â”‚
â”‚    â†“                                                                    â”‚
â”‚  Step 5: EVALUATION æŒ‡æ ‡åˆ†æ (å¿…æŸ¥ï¼Œå³ä½¿æˆåŠŸ)                             â”‚
â”‚          ğŸš¨ å¿…é¡»å…ˆæ‰§è¡Œ Step 5.0 æå– EVALUATION æ—¥å¿—                      â”‚
â”‚    â†“                                                                    â”‚
â”‚  Step 6: è¾“å‡ºè¯Šæ–­æŠ¥å‘Š                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“‹ Step 1: ä»»åŠ¡ç»Ÿè®¡

**ç›®çš„**ï¼šè·å–ä»»åŠ¡æ€»æ•°å’Œå¤±è´¥æ•°

**å‘½ä»¤**ï¼š
```bash
grep -E "Total Tasks|Successful|Failed" <log>
grep -E "TaskStatus\." <log> | grep -v SUCCESS
```

**å¿…é¡»è®°å½•**ï¼š
```
â–¡ ä»»åŠ¡æ€»æ•°: ____
â–¡ æˆåŠŸæ•°: ____
â–¡ å¤±è´¥æ•°: ____
â–¡ å¤±è´¥ä»»åŠ¡åˆ—è¡¨: (TASK_ID, STATUS, STAGE, DATA_NAME)
```

**è¾“å‡ºæ ¼å¼**ï¼š
```markdown
### Step 1: ä»»åŠ¡ç»Ÿè®¡

| é¡¹ç›® | å€¼ |
|------|------|
| ä»»åŠ¡æ€»æ•° | 635 |
| æˆåŠŸ | 628 |
| å¤±è´¥ | 7 |

#### å¤±è´¥ä»»åŠ¡åˆ—è¡¨

| TASK_ID | STATUS | STAGE | DATA_NAME |
|---------|--------|-------|-----------|
| 000041 | MODULE_CRASH | FUNCTION_TEST | l2driving-5504087086 |
| ... | ... | ... | ... |
```

**åˆ¤æ–­**ï¼š
- å¤±è´¥æ•° = 0 â†’ è·³åˆ° Step 3
- å¤±è´¥æ•° > 0 â†’ ç»§ç»­ Step 2

---

### ğŸ“‹ Step 2: å¤±è´¥ä»»åŠ¡ node_ret_codes åˆ†æ

**ç›®çš„**ï¼šä¸ºæ¯ä¸ªæ‰§è¡Œå¤±è´¥çš„ä»»åŠ¡æ‰¾åˆ°å…·ä½“è¿”å›ç ï¼Œå¹¶æ ¹æ®çŸ¥è¯†åº“åˆ¤æ–­æ ¹å› 

**âš ï¸ å¿…é¡»å…ˆé˜…è¯»çŸ¥è¯†åº“**ï¼š
```
åœ¨åˆ†æä»»ä½• TaskStatus ä¹‹å‰ï¼Œå¿…é¡»å…ˆé˜…è¯» knowledge/task-status-codes.md ä¸­å¯¹åº”çŠ¶æ€ç çš„å®Œæ•´ç« èŠ‚ï¼
```

**é€‚ç”¨çŠ¶æ€ç **ï¼ˆéœ€æŸ¥ node_ret_codesï¼‰ï¼š
- `TaskStatus.MODULE_CRASH` â†’ ğŸ“š è§çŸ¥è¯†åº“ 2.1 èŠ‚
- `TaskStatus.BAG_SELECT_INVALID` â†’ ğŸ“š è§çŸ¥è¯†åº“ 2.2 èŠ‚
- `TaskStatus.UNKNOW_DDL_CRASH` â†’ ğŸ“š è§çŸ¥è¯†åº“ 2.3 èŠ‚
- `TaskStatus.FAILED` â†’ ğŸ“š è§çŸ¥è¯†åº“ 2.4 èŠ‚

**ä¸éœ€è¦æŸ¥ node_ret_codes çš„çŠ¶æ€ç **ï¼š
- `TaskStatus.CATCH_THREAD_ISSUE` â†’ Step 4 åˆ†æ TSan
- `TaskStatus.CATCH_MEM_ERROR` â†’ Step 4 åˆ†æ Memcheck

**åˆ†ææµç¨‹**ï¼š

1. **é˜…è¯»çŸ¥è¯†åº“**ï¼šå…ˆé˜…è¯» `knowledge/task-status-codes.md` ä¸­è¯¥çŠ¶æ€ç çš„å®Œæ•´åˆ†ææ­¥éª¤
2. **è·å– node_ret_codes**ï¼š
   ```bash
   grep "node_ret_codes" <log>
   ```
3. **æŒ‰çŸ¥è¯†åº“åˆ¤æ–­æƒ…å†µ**ï¼šæ ¹æ®è¿”å›ç åˆ¤æ–­å±äºå“ªç§æƒ…å†µï¼ˆå¦‚æƒ…å†µ A/B/Cï¼‰
4. **å¾—å‡ºç»“è®ºå’Œå½’å±**ï¼šæ˜ç¡®å†™å‡ºæ ¹å› å’Œè´£ä»»å½’å±

**è¿”å›ç é€ŸæŸ¥**ï¼š

| è¿”å›ç  | ä¿¡å· | å«ä¹‰ |
|--------|------|------|
| 0 | - | æ­£å¸¸é€€å‡º |
| 6 | SIGABRT | æ–­è¨€å¤±è´¥ |
| 9 | SIGKILL | OOM è¢«æ€ |
| 11 | SIGSEGV | æ®µé”™è¯¯ |
| 111 | - | æ¡†æ¶è‡ªå®šä¹‰ |

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
### Step 2: å¤±è´¥ä»»åŠ¡ node_ret_codes åˆ†æ

| TASK_ID | STATUS | æ•°æ®é›† | node_ret_codes | æƒ…å†µåˆ¤æ–­ | ç»“è®º | å½’å± |
|---------|--------|--------|----------------|----------|------|------|
| 000041 | MODULE_CRASH | l2driving-xxx | `{"ddl_v2":0,"perception":11}` | æƒ…å†µA | perception SIGSEGV | æ¨¡å— crash |
| 000434 | BAG_SELECT_INVALID | YR-C01-9_xxx | `{"ddl_v2":111,"perception":11}` | æƒ…å†µA(è¿”å›ç â‰ 0) | perception å´©æºƒ | æ¨¡å— crashï¼ˆé bag é—®é¢˜ï¼‰|
```

---

### ğŸ“‹ Step 3: Stage çŠ¶æ€æ£€æŸ¥

**ç›®çš„**ï¼šè·å–æ‰€æœ‰ Stage çš„çŠ¶æ€

**å‘½ä»¤**ï¼š
```bash
# ä¿é™©æ–¹æ³•ï¼šåŠ¨æ€æå– Stage Summary Report
start=$(grep -n "======.*Stage Summary Report" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*========================================" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log_file> > /tmp/stage_summary.txt
cat /tmp/stage_summary.txt
```

**å¿…é¡»è®°å½•**ï¼š
```
â–¡ Stage.THREAD_SANITIZER: success/failed
â–¡ Stage.FUNCTION_TEST: success/failed
â–¡ Stage.EVALUATION: success/failed
â–¡ Stage.PERFORMANCE: success/failed
â–¡ Stage.MEMGATE_CPU: success/failed
â–¡ Stage.MEMGATE_GPU: success/failed
â–¡ Stage.MEMCHECK_CPU: success/failed
â–¡ Stage.CPU_MONITOR: success/failed
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
### Step 3: Stage çŠ¶æ€

| Stage | çŠ¶æ€ |
|-------|------|
| THREAD_SANITIZER | ğŸ”´ failed |
| FUNCTION_TEST | âœ… success |
| EVALUATION | âœ… success |
| PERFORMANCE | âœ… success |
```

**åˆ¤æ–­ä¸åç»­æ­¥éª¤**ï¼š
- å­˜åœ¨ failed Stage â†’ ç»§ç»­ Step 4ï¼Œä½†**åªåˆ†ææ ‡è®°ä¸º failed çš„ Stage**
- å…¨éƒ¨ success â†’ è·³åˆ° Step 5
- **é‡è¦**ï¼šåœ¨ Step 4 ä¸­ï¼Œå¯¹äº success æˆ–æœªè¿è¡Œçš„ Stageï¼Œç›´æ¥è¾“å‡º "N/A"ï¼Œä¸è¦æå–æ—¥å¿—æˆ–åˆ†ææ•°æ®

---

### ğŸ“‹ Step 4: å¤±è´¥ Stage æ·±å…¥åˆ†æ

**ç›®çš„**ï¼šå¯¹å¤±è´¥çš„ Stage è¿›è¡Œè¯¦ç»†åˆ†æ

**âš ï¸ æ—¥å¿—ç»“æ„è¯´æ˜**ï¼š
```
======================================== xxxx Summary ========================================
  ... xxxx stage çš„æ—¥å¿—ä¿¡æ¯ ...
======================================== yyyy Summary ========================================
  ... yyyy stage çš„æ—¥å¿—ä¿¡æ¯ ...
```

**ğŸš¨ é‡è¦è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰**ï¼š
- æ¯ä¸ª Stage çš„æ—¥å¿—èŒƒå›´ï¼šä» `"xxxx Summary"` å¼€å§‹ï¼Œåˆ°ä¸‹ä¸€ä¸ª `"yyyy Summary"` ç»“æŸ
- **ğŸ”´ åªåˆ†æå¤±è´¥çš„ Stage**ï¼šå¦‚æœæŸä¸ª Stage æ˜¯ success æˆ–æœªè¿è¡Œï¼Œåœ¨è¯¥å°èŠ‚ç›´æ¥è¾“å‡º "N/A"ï¼Œä¸è¦æå–æ—¥å¿—ã€ä¸è¦åˆ†ææ•°æ®
- **ä¸è¦æ··æ·†ä¸åŒ Stage**ï¼šä¾‹å¦‚ GPU Memory Gate å±äº MEMGATE_GPU Stageï¼Œä¸å±äº EVALUATION
- **ğŸ”´ æ¯ä¸ª Stage å¿…é¡»å•ç‹¬æå–æ—¥å¿—**ï¼šç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­ç›´æ¥æœç´¢ï¼Œç¦æ­¢å¤ç”¨å…¶ä»– Stage æå–çš„æ—¥å¿—

**æ‰§è¡Œæµç¨‹**ï¼š
1. å…ˆæ ¹æ® Step 3 çš„ç»“æœï¼Œç¡®å®šå“ªäº› Stage æ˜¯ failed
2. **å¯¹æ¯ä¸ª failed çš„ Stage**ï¼š
   - **ç¬¬ä¸€æ­¥**ï¼šæ‰§è¡Œå¯¹åº”çš„ Step 4.x.0ï¼ˆæå–è¯¥ Stage çš„æ—¥å¿—è¾¹ç•Œåˆ°ä¸´æ—¶æ–‡ä»¶ï¼‰
   - **ç¬¬äºŒæ­¥**ï¼šåœ¨æå–å‡ºçš„ä¸´æ—¶æ–‡ä»¶ä¸­è¿›è¡Œæ‰€æœ‰åç»­æœç´¢
   - **ç¦æ­¢**ï¼šè·³è¿‡ Step 4.x.0 ç›´æ¥åœ¨å…¨å±€æ—¥å¿—æœç´¢
   - **ç¦æ­¢**ï¼šä½¿ç”¨å…¶ä»– Stage æå–çš„ä¸´æ—¶æ–‡ä»¶
3. å¯¹äº success æˆ–æœªè¿è¡Œçš„ Stageï¼Œç›´æ¥åœ¨æŠ¥å‘Šä¸­æ ‡æ³¨ "N/A"

**âŒ é”™è¯¯ç¤ºä¾‹**ï¼š
```bash
# é”™è¯¯ï¼šç›´æ¥åœ¨å…¨å±€æ—¥å¿—æœç´¢ Performance æ•°æ®
grep "NotPass" /tmp/job_full.log

# é”™è¯¯ï¼šä½¿ç”¨ EVALUATION çš„ä¸´æ—¶æ–‡ä»¶æœç´¢ Performance æ•°æ®
grep "NotPass" /tmp/eval_section.txt
```

**âœ… æ­£ç¡®ç¤ºä¾‹**ï¼š
```bash
# æ­¥éª¤1ï¼šæå– Performance Stage æ—¥å¿—
start=$(grep -n "Performance Test Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log> > /tmp/performance.txt

# æ­¥éª¤2ï¼šåœ¨ Performance ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢
grep "NotPass" /tmp/performance.txt
```

æ ¹æ®å¤±è´¥çš„ Stage ç±»å‹ï¼Œæ‰§è¡Œå¯¹åº”çš„åˆ†ææµç¨‹ï¼š

#### 4.1 FUNCTION_TEST åˆ†æ

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.FUNCTION_TEST` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**Step 4.1.0 æå– Function Test æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå°† Function Test Stage æ—¥å¿—æå–åˆ°ç‹¬ç«‹æ–‡ä»¶ï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*Function Test Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/function_test.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
echo "æå–è¡Œæ•°: $(wc -l < /tmp/function_test.txt)"
head -3 /tmp/function_test.txt
tail -3 /tmp/function_test.txt
```

> **âš ï¸ æ³¨æ„**ï¼šåç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/function_test.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—æˆ–å…¶ä»–ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢

**åˆ†æè¦ç‚¹**ï¼š
1. ç¡®å®šå¤±è´¥ä»»åŠ¡çš„ `node_ret_codes`ï¼Œåˆ¤æ–­æ˜¯å“ªä¸ªæ¨¡å—å´©æºƒ
2. æ ¹æ®è¿”å›ç åˆ¤æ–­å´©æºƒç±»å‹ï¼ˆSIGSEGV=11, SIGABRT=6, SIGKILL=9ï¼‰
3. æŸ¥æ‰¾å´©æºƒå‰çš„é”™è¯¯æ—¥å¿—å®šä½æ ¹å› 

**å‘½ä»¤**ï¼š
```bash
# åœ¨ Function Test èŒƒå›´å†…æœç´¢å¤±è´¥ä»»åŠ¡å’Œè¿”å›ç 
grep "node_ret_codes" /tmp/function_test.txt
grep -E "FATAL|Segmentation fault|SIGSEGV" /tmp/function_test.txt
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
#### FUNCTION_TEST å¤±è´¥åˆ†æ

**é”™è¯¯æ—¥å¿—**ï¼š
[å…³é”®é”™è¯¯ä¿¡æ¯æ‘˜å½•]

**å¯èƒ½çš„åŸå› **ï¼š[å…·ä½“æè¿°]

**ä¿®å¤å»ºè®®**ï¼š[å…·ä½“æ–¹æ³•]
```

#### 4.2 THREAD_SANITIZER åˆ†æ

> ğŸ“š è¯¦è§ `knowledge/tsan-analysis.md`

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.THREAD_SANITIZER` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**Step 4.2.0 æå– Thread Sanitizer æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œç¦æ­¢è·³è¿‡æˆ–åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢ TSan æ•°æ®ï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*Thread Sanitizer Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/tsan.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
echo "æå–è¡Œæ•°: $(wc -l < /tmp/tsan.txt)"
grep -c "WARNING: ThreadSanitizer" /tmp/tsan.txt  # æ£€æŸ¥åŒ…å«çš„è­¦å‘Šæ•°
```

> **âš ï¸ æ³¨æ„**ï¼šåç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/tsan.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢

**å‘½ä»¤**ï¼š
```bash
# åœ¨ Thread Sanitizer èŒƒå›´å†…æœç´¢ data race è¯¦æƒ…
grep "WARNING: ThreadSanitizer" /tmp/tsan.txt
grep "data race" /tmp/tsan.txt -A 40
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
#### TSan Data Race åˆ†æ

| æ“ä½œ | çº¿ç¨‹ | å‡½æ•° | ä»£ç ä½ç½® |
|------|------|------|---------|
| è¯» | T45 | std::_Hashtable::count() | nn_internal_impl_cuda.cc:203 |
| å†™ | T49 | std::_Hashtable æ„é€  | nn_internal_impl_cuda.cc:203 |

**è°ƒç”¨é“¾**ï¼š
- è¯»çº¿ç¨‹: Calculator::Open() â†’ Processor::Create() â†’ InitNn()
- å†™çº¿ç¨‹: Calculator::Open() â†’ Processor::Create() â†’ InitNn()

**æ ¹å› **ï¼š[å…·ä½“æè¿°]

**ä¿®å¤å»ºè®®**ï¼š[å…·ä½“ä½ç½®å’Œæ–¹æ³•]
```

#### 4.3 MEMCHECK_CPU åˆ†æ

> ğŸ“š è¯¦è§ `knowledge/memcheck-analysis.md`

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.MEMCHECK_CPU` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**Step 4.3.0 æå– Memcheck CPU æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œç¦æ­¢è·³è¿‡æ­¤æ­¥éª¤ï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*Memchek Cpu Test Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/memcheck.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
echo "æå–è¡Œæ•°: $(wc -l < /tmp/memcheck.txt)"
```

> **âš ï¸ æ³¨æ„**ï¼šåç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/memcheck.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢

**å‘½ä»¤**ï¼š
```bash
# åœ¨ Memcheck èŒƒå›´å†…æœç´¢å†…å­˜é—®é¢˜
grep -E "definitely lost|indirectly lost|possibly lost" /tmp/memcheck.txt
grep "Invalid read\|Invalid write" /tmp/memcheck.txt
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
#### Memcheck åˆ†æ

| é”™è¯¯ç±»å‹ | æ•°é‡ | ä½ç½® |
|----------|------|------|
| Definite leak | 1 | planning/optimizer.cc:123 |
| Uninit read | 3 | planning/cost.cc:456 |

**ä¿®å¤å»ºè®®**ï¼š[å…·ä½“æ–¹æ³•]
```

#### 4.4 PERFORMANCE åˆ†æ

> ğŸ“š å®Œæ•´æ–¹æ³•è®ºè§ `knowledge/performance-analysis.md`ï¼Œä¸‹æ–¹å·²å°†æ ¸å¿ƒä¸‰æ­¥æ³•å†…è”ä¸ºå¼ºåˆ¶æ‰§è¡Œæ­¥éª¤ã€‚

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.PERFORMANCE` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**ğŸ“Š Performance æ—¥å¿—ç»“æ„è¯´æ˜**ï¼š

Performance Stage çš„æ—¥å¿—ç»“æ„å¦‚ä¸‹ï¼š
```
======================================== Performance Test Summary ========================================
(å¯é€‰åœºæ™¯åˆ†å‰²) xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx scene1 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
======================================== Testline ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„æµ‹è¯•ç‰ˆæœ¬æ•°æ® ...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„æµ‹è¯•ç‰ˆæœ¬æ•°æ® ...
======================================== Baseline ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„åŸºå‡†ç‰ˆæœ¬æ•°æ® ...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„åŸºå‡†ç‰ˆæœ¬æ•°æ® ...
======================================== Contrast ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„å¯¹æ¯”ç»“æœï¼ˆåŒ…å« NotPass æ ‡è®°ï¼‰...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„å¯¹æ¯”ç»“æœï¼ˆåŒ…å« NotPass æ ‡è®°ï¼‰...
(å¯é€‰åœºæ™¯åˆ†å‰²) xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx scene2 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
======================================== Testline ========================================
...
```

**é‡è¦æ¦‚å¿µ**ï¼š
- **Sceneï¼ˆæµ‹è¯•åœºæ™¯ï¼‰**ï¼šç”¨ `xxxxxxxx scene_name xxxxxxxx` æ ¼å¼åˆ†å‰²ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªåœºæ™¯åˆ™æ— åœºæ™¯åˆ†éš”çº¿
- **Testline**ï¼šå½“å‰æµ‹è¯•ç‰ˆæœ¬çš„æ€§èƒ½æ•°æ®
- **Baseline**ï¼šåŸºå‡†ç‰ˆæœ¬çš„æ€§èƒ½æ•°æ®
- **Contrast**ï¼šå¯¹æ¯”ç»“æœï¼Œ**å¤±è´¥é¡¹åœ¨è¿™é‡Œç”¨ NotPass æ ‡è®°**ï¼ˆåªéœ€åœ¨ Contrast éƒ¨åˆ†æœç´¢ï¼‰
- **Modeï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰**ï¼šå¦‚ L2_NCAã€DRIVINGã€PARKING ç­‰ï¼Œä¸åŒæ¨¡å¼çš„æ•°æ®ç›¸äº’ç‹¬ç«‹ï¼Œç”¨ `---- mode_name ----` åˆ†å‰²

> **ğŸ”´ Contrast é‡è¦é™åˆ¶**ï¼šContrast åªå¯¹æ¯” Testline å’Œ Baseline **éƒ½å­˜åœ¨çš„ node** çš„è€—æ—¶ã€‚æ–°å¢æˆ–åˆ é™¤çš„ node ä¸ä¼šå‡ºç°åœ¨ Contrast ä¸­ï¼Œéœ€é¢å¤–å¯¹æ¯” Testline ä¸ Baseline åŸå§‹æ•°æ®ã€‚

**ğŸš¨ğŸš¨ğŸš¨ Performance åˆ†æå¿…é¡»ä¸¥æ ¼æ‰§è¡Œä¸‰æ­¥æ³•ï¼ˆStep A â†’ B â†’ Cï¼‰ï¼Œç¦æ­¢ä»… grep NotPass åç›´æ¥è¾“å‡ºï¼**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Performance ä¸‰æ­¥æ³•å¼ºåˆ¶æµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Step 4.4.0: æå– Performance æ—¥å¿—åˆ° /tmp/performance.txt                   â”‚
â”‚    â†“                                                                        â”‚
â”‚  Step 4.4.1: ç¡®å®šè¡Œå·è¾¹ç•Œï¼ˆScene/Testline/Baseline/Contrastï¼‰               â”‚
â”‚    â†“                                                                        â”‚
â”‚  Step 4.4.A: ã€ä¸‰æ­¥æ³• Step Aã€‘Single Thread Eval Contrast â†’ çœŸæ­£å›é€€        â”‚
â”‚              æ”¶é›†æ‰€æœ‰ Scene çš„ Contrast NotPassï¼Œæ ‡æ³¨ Scene+Mode              â”‚
â”‚              å·®å€¼å¿…é¡»ç»™å‡ºç»å¯¹å€¼å’Œç›¸å¯¹å€¼                                        â”‚
â”‚    â†“                                                                        â”‚
â”‚  Step 4.4.B: ã€ä¸‰æ­¥æ³• Step Bã€‘ä»…å¤šçº¿ç¨‹ NotPass çš„ node â†’ èµ„æºç«äº‰åˆ†æ        â”‚
â”‚              ğŸ”´ å¿…é¡»æå– Calculator Frame time ä¸­çš„ Start/End/Process        â”‚
â”‚              ğŸ”´ å¿…é¡»åˆ—å‡ºæ‰€æœ‰é‡å  node åŠå…¶ Process å˜åŒ–                       â”‚
â”‚              ğŸ”´ å¦‚ä¸º GPU nodeï¼Œå¿…é¡»å¯¹æ¯” mighty ç­‰æ¨¡å‹çš„ p50/stdev åˆ†å¸ƒå˜åŒ–    â”‚
â”‚    â†“                                                                        â”‚
â”‚  Step 4.4.C: ã€ä¸‰æ­¥æ³• Step Cã€‘Contrast ç›²åŒº â†’ æ–°å¢/åˆ é™¤ Node æ£€æŸ¥            â”‚
â”‚              ğŸ”´ å¿…é¡»ä» Testline/Baseline çš„ Calculator Frame time æå–       â”‚
â”‚                 node åˆ—è¡¨ï¼Œæ±‚å·®é›†                                             â”‚
â”‚              ğŸ”´ å¿…é¡»æ£€æŸ¥æ–°å¢ node æ˜¯å¦ä¸å›é€€ node æ—¶é—´çª—å£é‡å                 â”‚
â”‚    â†“                                                                        â”‚
â”‚  Step 4.4.D: æ±‡æ€»åˆ¤å®šè¡¨ï¼ˆæ¯ä¸ª NotPass node åˆ†ç±» + ä¾æ®ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Step 4.4.0 æå– Performance æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå°† Performance Stage çš„å®Œæ•´æ—¥å¿—æå–åˆ° `/tmp/performance.txt`ï¼Œåç»­æ‰€æœ‰ Step 4.4.x æ­¥éª¤éƒ½åªèƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æœç´¢ï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—æˆ–å…¶ä»–ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢ï¼

```bash
# æ‰¾åˆ° Performance Test Summary çš„èµ·å§‹è¡Œå·
perf_start=$(grep -n "======.*Performance Test Summary" <log> | cut -d: -f1)

# æ‰¾åˆ°ä¸‹ä¸€ä¸ª Summary çš„ç›¸å¯¹è¡Œå·
next_line=$(tail -n +$((perf_start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)

# è®¡ç®— Performance çš„ç»“æŸè¡Œå·
perf_end=$((perf_start + next_line - 1))

# æå–å®Œæ•´çš„ Performance æ—¥å¿—
sed -n "${perf_start},${perf_end}p" <log> > /tmp/performance.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
echo "æå–è¡Œæ•°: $(wc -l < /tmp/performance.txt)"
echo "åœºæ™¯æ•°é‡: $(grep -c 'xxxxxxxx.*xxxxxxxx' /tmp/performance.txt)"
```

> **âš ï¸ æ³¨æ„**ï¼š
> - åç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/performance.txt` ä¸­è¿›è¡Œ
> - åŠ¡å¿…éªŒè¯åœºæ™¯æ•°é‡ï¼Œç¡®ä¿æ‰€æœ‰åœºæ™¯éƒ½è¢«æå–

**Step 4.4.1 ç¡®å®šè¡Œå·è¾¹ç•Œ**ï¼š

> **ğŸš¨ å¿…é¡»æ‰§è¡Œ**ï¼šåç»­ Step A/B/C éƒ½ä¾èµ–ç²¾ç¡®çš„è¡Œå·èŒƒå›´ï¼Œç¦æ­¢è·³è¿‡ï¼

```bash
# 1. ç¡®å®šæ‰€æœ‰ Scene çš„è¡Œå·
grep -n "xxxxxxxx.*xxxxxxxx" /tmp/performance.txt

# 2. ç¡®å®šæ‰€æœ‰ Testline/Baseline/Contrast çš„è¡Œå·
grep -n "========.*Testline\|========.*Baseline\|========.*Contrast" /tmp/performance.txt

# 3. ç¡®å®šå„ Mode çš„è¡Œå·
grep -n "^---.*---$" /tmp/performance.txt
```

> **å¿…é¡»è®°å½•**ï¼ˆç¤ºä¾‹ï¼‰ï¼š
> ```
> Single Thread Eval (line 4~4221):
>   Testline: 7~1447, Baseline: 1448~2816, Contrast: 2817~4221
> Multi Thread Eval (line 6283~11393):
>   Testline: 6286~8023, Baseline: 8024~9689, Contrast: 9690~11393
> ```

---

**Step 4.4.Aã€ä¸‰æ­¥æ³• Step Aã€‘Single Thread Eval Contrast â€” åˆ¤å®šçœŸæ­£å›é€€**ï¼š

> **ğŸ”´ æ ¸å¿ƒåŸåˆ™ï¼šä»¥ Single Thread Eval ä¸ºåˆ¤å®šåŸºå‡†ã€‚å•çº¿ç¨‹ä¸­ NotPass = çœŸæ­£å›é€€ï¼Œå•çº¿ç¨‹ä¸­ Pass = å³ä½¿å¤šçº¿ç¨‹ NotPass ä¹Ÿä¸æ˜¯çœŸæ­£å›é€€ã€‚**

```bash
# 1. åœ¨ Single Thread Eval çš„ Contrast èŒƒå›´å†…æœç´¢æ‰€æœ‰ NotPass
sed -n '<ST_Contrast_start>,<ST_Contrast_end>p' /tmp/performance.txt | grep "NotPass"

# 2. å¯¹äºå¤šçº¿ç¨‹æœ‰ NotPass ä½†å•çº¿ç¨‹æ²¡æœ‰çš„ nodeï¼Œç¡®è®¤å…¶åœ¨å•çº¿ç¨‹ä¸­çš„çŠ¶æ€
sed -n '<ST_Contrast_start>,<ST_Contrast_end>p' /tmp/performance.txt | grep "<target_node>"
```

**å¿…é¡»è¾“å‡º**ï¼š

```markdown
##### Step A: Single Thread Eval NotPassï¼ˆçœŸæ­£å›é€€ï¼‰

| Mode | Group | å¤±è´¥å…ƒç´  | æµ‹è¯•å€¼ (ms) | åŸºçº¿å€¼ (ms) | ç»å¯¹å·®å€¼ | ç›¸å¯¹å·®å€¼ | é˜ˆå€¼ | çŠ¶æ€ |
|------|-------|----------|------------|------------|---------|---------|------|------|
| LOW_SPEED | Calculator time | xxx | 16.74 | 15.99 | +0.75 ms | +4.67% | 0.66 | âŒ NotPass |

**åŒæ—¶ç¡®è®¤å¤šçº¿ç¨‹ NotPass ä½†å•çº¿ç¨‹ Pass çš„ node**ï¼š
- aroundview_det: å•çº¿ç¨‹ +0.04 ms (+2.23%) â†’ Pass â†’ éçœŸæ­£å›é€€ï¼Œè¿›å…¥ Step B
```

> **âš ï¸ å·®å€¼æ ¼å¼å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»åŒæ—¶ç»™å‡º**ç»å¯¹å·®å€¼**ï¼ˆå¦‚ +0.75 msï¼‰å’Œ**ç›¸å¯¹å·®å€¼**ï¼ˆå¦‚ +4.67%ï¼‰ï¼Œç¦æ­¢åªç»™å…¶ä¸­ä¸€ä¸ªã€‚

---

**Step 4.4.Bã€ä¸‰æ­¥æ³• Step Bã€‘ä»…å¤šçº¿ç¨‹ NotPass â€” èµ„æºç«äº‰åˆ†æ**ï¼š

> **æ‰§è¡Œå‰æ**ï¼šä»…å½“å­˜åœ¨ "å•çº¿ç¨‹ Pass ä½†å¤šçº¿ç¨‹ NotPass" çš„ node æ—¶æ‰éœ€è¦æ‰§è¡Œï¼Œå¦åˆ™è·³è¿‡ã€‚

**åˆ†ææµç¨‹**ï¼š

1. **æå–ç›®æ ‡ node çš„ Calculator Frame time**ï¼ˆä» Multi Thread Contrastï¼‰ï¼š
```bash
# åœ¨ Multi Thread Contrast çš„ Calculator Frame time analysis ä¸­æ‰¾ç›®æ ‡ node
sed -n '<MT_Contrast_start>,<MT_Contrast_end>p' /tmp/performance.txt | grep "<target_node>:" -A 5
```

2. **æŸ¥æ‰¾æ‰€æœ‰ä¸ç›®æ ‡ node æ—¶é—´çª—å£é‡å çš„ node**ï¼š
```bash
# ç”¨ awk ä» Calculator Frame time æå–æ‰€æœ‰ node çš„ Start/End/Processï¼Œç­›é€‰é‡å çš„
awk '
/perception_subgraph.*:/ { node=$0; gsub(/^ */, "", node); gsub(/:$/, "", node) }
/Start / && !/@@/ { split($0, a); start_test=a[2]; start_base=a[3] }
/Process / && !/@@/ { split($0, a); proc_test=a[2]; proc_base=a[3] }
/End / && !/@@/ {
    split($0, a); end_test=a[2]; end_base=a[3];
    if (start_test+0 < <TARGET_END> && end_test+0 > <TARGET_START>) {
        printf "%-60s Start=%-8s End=%-8s Proc=%-8s(base=%-8s diff=%+.4f)\n",
               node, start_test, end_test, proc_test, proc_base, proc_test-proc_base
    }
}' /tmp/mt_mode_frame.txt
```

3. **å¦‚ä¸º GPU NN nodeï¼Œå¯¹æ¯”æ¨¡å‹åˆ†å¸ƒå˜åŒ–**ï¼ˆä» Testline/Baseline åŸå§‹æ•°æ®ï¼‰ï¼š
```bash
# æå– mighty ç­‰ GPU æ¨¡å‹çš„ p50/stdev åˆ†å¸ƒ
sed -n '<MT_Testline_mode_start>,<MT_Testline_mode_end>p' /tmp/performance.txt | grep -A 5 "mighty:"
sed -n '<MT_Baseline_mode_start>,<MT_Baseline_mode_end>p' /tmp/performance.txt | grep -A 5 "mighty:"
```

**å¿…é¡»è¾“å‡º**ï¼š

```markdown
##### Step B: èµ„æºç«äº‰åˆ†æ â€” <target_node>

**ç›®æ ‡ node æ—¶é—´çª—å£**ï¼ˆMulti Thread <MODE> Contrastï¼‰ï¼š
- Start = X.XX ms, End = X.XX ms
- Process = X.XX msï¼ˆbaseline = X.XX msï¼Œå·®å€¼ = +X.XX ms / +XX.XX%ï¼‰

**ä¸ç›®æ ‡ node æ—¶é—´çª—å£ [X.XX, X.XX] é‡å çš„æ‰€æœ‰ node**ï¼š

| é‡å  Node | Start (ms) | End (ms) | Process æµ‹è¯• (ms) | Process åŸºçº¿ (ms) | Process å·®å€¼ | æ˜¯å¦æ˜¾è‘— |
|-----------|-----------|---------|-----------------|-----------------|-------------|---------|
| mighty | 5.01 | 78.77 | 73.76 | 90.43 | -16.67 ms (-18.45%) | â¬‡ï¸ å¤§å¹…å‡å°‘ |
| ... | ... | ... | ... | ... | ... | ... |

**GPU æ¨¡å‹åˆ†å¸ƒå˜åŒ–**ï¼ˆå¦‚æ¶‰åŠ GPU nodeï¼‰ï¼š

| æŒ‡æ ‡ | Testline | Baseline | å˜åŒ– |
|------|---------|---------|------|
| Process p50 | 73.83 ms | 93.60 ms | -19.77 ms |
| Process stdev | 0.59 | 6.22 | æ–¹å·®å¤§å¹…é™ä½ |

**Step B ç»“è®º**ï¼š[å…·ä½“æè¿°ç«äº‰æ¥æºæˆ– GPU è°ƒåº¦å˜åŒ–]
```

---

**Step 4.4.Cã€ä¸‰æ­¥æ³• Step Cã€‘Contrast ç›²åŒº â€” æ–°å¢/åˆ é™¤ Node æ£€æŸ¥**ï¼š

> **æ‰§è¡Œå‰æ**ï¼šä»…å½“å­˜åœ¨ "å•çº¿ç¨‹ Pass ä½†å¤šçº¿ç¨‹ NotPass" çš„ node æ—¶æ‰éœ€è¦æ‰§è¡Œï¼Œå¦åˆ™è·³è¿‡ã€‚

```bash
# 1. åˆ†åˆ«ä» Testline å’Œ Baseline çš„ Calculator Frame time æå– node åˆ—è¡¨
sed -n '<MT_Testline_mode_start>,<MT_Testline_mode_end>p' /tmp/performance.txt \
  | grep "Calculator Frame time" -A 1000 \
  | grep "perception_subgraph.*:" | sed 's/^ *//' | sort > /tmp/testline_nodes.txt

sed -n '<MT_Baseline_mode_start>,<MT_Baseline_mode_end>p' /tmp/performance.txt \
  | grep "Calculator Frame time" -A 1000 \
  | grep "perception_subgraph.*:" | sed 's/^ *//' | sort > /tmp/baseline_nodes.txt

# 2. æ±‚å·®é›†
echo "=== æ–°å¢ node ==="
comm -23 /tmp/testline_nodes.txt /tmp/baseline_nodes.txt
echo "=== åˆ é™¤ node ==="
comm -13 /tmp/testline_nodes.txt /tmp/baseline_nodes.txt

# 3. æ£€æŸ¥æ–°å¢ node çš„ Start/Endï¼Œåˆ¤æ–­æ˜¯å¦ä¸å›é€€ node æ—¶é—´çª—å£é‡å 
```

**å¿…é¡»è¾“å‡º**ï¼š

```markdown
##### Step C: æ–°å¢/åˆ é™¤ Node æ£€æŸ¥

**æ–°å¢ nodeï¼ˆX ä¸ªï¼‰**ï¼š

| æ–°å¢ Node | Start (ms) | End (ms) | Process (ms) | ä¸ç›®æ ‡ node [X.XX, X.XX] é‡å ï¼Ÿ |
|-----------|-----------|---------|-------------|-------------------------------|
| XxxCalculator | 1.44 | 3.91 | 2.47 | âŒ ä¸é‡å ï¼ˆEnd < ç›®æ ‡ Startï¼‰ |

**åˆ é™¤ nodeï¼ˆX ä¸ªï¼‰**ï¼š[åˆ—è¡¨æˆ–"æ— "]

**Step C ç»“è®º**ï¼š[æ˜¯å¦æœ‰æ–°å¢ node å¯¼è‡´èµ„æºç«äº‰]
```

---

**Step 4.4.D æœ€ç»ˆåˆ¤å®šæ±‡æ€»**ï¼š

> **ğŸš¨ å¿…é¡»è¾“å‡ºæ­¤è¡¨**ï¼šå°†æ‰€æœ‰ NotPass node æŒ‰ä¸‰æ­¥æ³•ç»“æœåˆ†ç±»ã€‚

```markdown
##### æœ€ç»ˆåˆ¤å®šæ±‡æ€»

| NotPass Node | å‡ºç°åœºæ™¯ | å•çº¿ç¨‹çŠ¶æ€ | åˆ†ç±» | åˆ¤å®šä¾æ® |
|-------------|---------|----------|------|---------|
| xxx | å…¨åœºæ™¯ | âŒ NotPass | çœŸæ­£å›é€€ â€” æ–°å¢å›ºå®šè€—æ—¶ | baseline=0ms, testline=1ms |
| yyy | ST LOW_SPEED/DRIVING | âŒ NotPass | çœŸæ­£å›é€€ â€” æ¸è¿›å¼é€€åŒ– | +0.75~0.91 ms (+4.67%~5.73%) |
| zzz | MT LOW_SPEED/PARKING | âœ… Pass | GPU è°ƒåº¦å˜åŒ– | mighty p50 ä» 93.6â†’73.8ms, stdev ä» 6.22â†’0.59; æ— é‡å  node Process å¢åŠ ; æ— æ–°å¢ node é‡å  |
```

**åˆ†ç±»æ ‡å‡†**ï¼š

| åˆ†ç±» | åˆ¤å®šæ¡ä»¶ | å«ä¹‰ |
|------|----------|------|
| **çœŸæ­£å›é€€ â€” æ–°å¢å›ºå®šè€—æ—¶** | å•çº¿ç¨‹ NotPass + baselineâ‰ˆ0ms | æ–°å¢äº† Calculator/sleep/é”ç­‰å¾… |
| **çœŸæ­£å›é€€ â€” æ¸è¿›å¼é€€åŒ–** | å•çº¿ç¨‹ NotPass + ä¸€è‡´æ€§ç™¾åˆ†æ¯”å¢é•¿ | CPU å¤„ç†é€»è¾‘å˜é‡ |
| **èµ„æºç«äº‰** | å•çº¿ç¨‹ Pass + å¤šçº¿ç¨‹æœ‰é‡å  node Process å¢åŠ  | å…¶ä»– node æŠ¢å èµ„æº |
| **GPU è°ƒåº¦å˜åŒ–** | å•çº¿ç¨‹ Pass + æ— é‡å  Process å¢åŠ  + GPU æ¨¡å‹åˆ†å¸ƒå·¨å˜ | GPU æ¨¡å‹æ‰§è¡Œæ¨¡å¼æ”¹å˜ |
| **æ–°å¢ Node å½±å“** | å•çº¿ç¨‹ Pass + æ–°å¢ node ä¸å›é€€ node æ—¶é—´é‡å  | æ–°å¢ node å ç”¨å…±äº«èµ„æº |

**ä¿®å¤å»ºè®®**ï¼ˆæŒ‰åˆ†ç±»ï¼‰ï¼š
- **çœŸæ­£å›é€€**ï¼šæ’æŸ¥å¯¹åº” node çš„è¿‘æœŸä»£ç å˜æ›´ï¼Œä¼˜åŒ–æˆ–å›æ»š
- **èµ„æºç«äº‰/æ–°å¢ Node å½±å“**ï¼šæ’æŸ¥å¯¼è‡´ç«äº‰çš„ nodeï¼Œä¼˜åŒ–å…¶è€—æ—¶
- **GPU è°ƒåº¦å˜åŒ–**ï¼šå¦‚ä¸ºé¢„æœŸæ¨¡å‹æ›´æ–°åˆ™æ›´æ–° baselineï¼Œå¦åˆ™è°ƒæ•´ GPU è°ƒåº¦ç­–ç•¥

#### 4.5 CPU_MONITOR åˆ†æ

> ğŸ“š è¯¦è§ `knowledge/resource-analysis.md`

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.CPU_MONITOR` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**ğŸ“Š CPU Monitor æ—¥å¿—ç»“æ„è¯´æ˜**ï¼š

CPU Monitor Stage çš„æ—¥å¿—ç»“æ„å¦‚ä¸‹ï¼š
```
======================================== CPU Monitor Summary ========================================
======================================== CPU Monitor Testline ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„æµ‹è¯•ç‰ˆæœ¬ CPU æ•°æ® ...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„æµ‹è¯•ç‰ˆæœ¬ CPU æ•°æ® ...
======================================== CPU Monitor Baseline ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„åŸºå‡†ç‰ˆæœ¬ CPU æ•°æ® ...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„åŸºå‡†ç‰ˆæœ¬ CPU æ•°æ® ...
======================================== CPU Monitor Contrast ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„å¯¹æ¯”ç»“æœï¼ˆåŒ…å« FAIL æ ‡è®°ï¼‰...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„å¯¹æ¯”ç»“æœï¼ˆåŒ…å« FAIL æ ‡è®°ï¼‰...
```

**é‡è¦æ¦‚å¿µ**ï¼š
- **Modeï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰**ï¼šå¦‚ Defaultã€DRIVINGã€PARKING ç­‰ï¼Œä¸åŒæ¨¡å¼çš„æ•°æ®ç›¸äº’ç‹¬ç«‹
- **Contrast éƒ¨åˆ†**ï¼šå¯¹æ¯”ç»“æœï¼Œ**å¤±è´¥é¡¹åœ¨è¿™é‡Œç”¨ FAIL æ ‡è®°**
- **æŒ‡æ ‡**ï¼šProcess TOTALï¼ˆæ€» CPU æ—¶é—´ï¼‰ã€Process Mean Usageï¼ˆå¹³å‡ CPU ä½¿ç”¨ç‡ï¼‰ç­‰

**Step 4.5.0 æå– CPU Monitor æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œç¦æ­¢è·³è¿‡æˆ–ä½¿ç”¨å…¶ä»– Stage çš„ä¸´æ—¶æ–‡ä»¶ï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*CPU Monitor Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/cpu_monitor.txt

# æˆ–ä½¿ç”¨è¶³å¤Ÿå¤§çš„è¡Œæ•°
# grep "======.*CPU Monitor Summary" <log> -A 500 | sed '1!{/======.*Summary/q;}' > /tmp/cpu_monitor.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
wc -l /tmp/cpu_monitor.txt
```

> **âš ï¸ æ³¨æ„**ï¼šåç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/cpu_monitor.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢

**å‘½ä»¤**ï¼š
```bash
# åœ¨ CPU Monitor èŒƒå›´å†…æœç´¢å¤±è´¥é¡¹ï¼ˆåªåœ¨ Contrast éƒ¨åˆ†ï¼‰
grep -E "FAIL" /tmp/cpu_monitor.txt

# æˆ–è€…æŸ¥çœ‹å®Œæ•´çš„ Contrast éƒ¨åˆ†
grep "======.*Contrast" /tmp/cpu_monitor.txt -A 100
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
#### CPU Monitor åˆ†æ

| Plug | æŒ‡æ ‡ | æµ‹è¯•å€¼ | åŸºçº¿å€¼ | å¢é‡ | é˜ˆå€¼ | çŠ¶æ€ |
|------|------|--------|--------|------|------|------|
| Default | Process TOTAL | 41.33 s | 39.91 s | +1.41 s (+3.54%) | 2.00% | âŒ FAIL |

**å¯èƒ½åŸå› **ï¼š[åˆ†æåŸå› ]

**ä¿®å¤å»ºè®®**ï¼š[å…·ä½“æ–¹æ³•]
```

#### 4.6 MEMGATE_GPU åˆ†æ

> ğŸ“š è¯¦è§ `knowledge/resource-analysis.md`

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.MEMGATE_GPU` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**ğŸ“Š GPU Memory Gate æ—¥å¿—ç»“æ„è¯´æ˜**ï¼š

GPU Memory Gate Stage çš„æ—¥å¿—ç»“æ„å¦‚ä¸‹ï¼š
```
======================================== Gpu Memory Gate Summary ========================================
======================================== Testline ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„æµ‹è¯•ç‰ˆæœ¬ GPU å†…å­˜æ•°æ® ...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„æµ‹è¯•ç‰ˆæœ¬ GPU å†…å­˜æ•°æ® ...
======================================== Baseline ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„åŸºå‡†ç‰ˆæœ¬ GPU å†…å­˜æ•°æ® ...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„åŸºå‡†ç‰ˆæœ¬ GPU å†…å­˜æ•°æ® ...
======================================== Contrast ========================================
---------------------------------------- mode1 ----------------------------------------
  ... mode1 çš„å¯¹æ¯”ç»“æœï¼ˆåŒ…å« FAIL æ ‡è®°ï¼‰...
---------------------------------------- mode2 ----------------------------------------
  ... mode2 çš„å¯¹æ¯”ç»“æœï¼ˆåŒ…å« FAIL æ ‡è®°ï¼‰...
```

**é‡è¦æ¦‚å¿µ**ï¼š
- **Modeï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰**ï¼šå¦‚ DRIVINGã€PARKING ç­‰ï¼Œä¸åŒæ¨¡å¼çš„æ•°æ®ç›¸äº’ç‹¬ç«‹
- **Contrast éƒ¨åˆ†**ï¼šå¯¹æ¯”ç»“æœï¼Œ**å¤±è´¥é¡¹åœ¨è¿™é‡Œç”¨ FAIL æˆ– PASS æ ‡è®°**
- **æŒ‡æ ‡**ï¼šPEAKï¼ˆå³°å€¼å†…å­˜ï¼‰ã€PROCESSï¼ˆè¿›ç¨‹å†…å­˜ï¼‰ç­‰

**Step 4.6.0 æå– GPU Memory Gate æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œç¦æ­¢è·³è¿‡æˆ–ä½¿ç”¨å…¶ä»– Stage çš„ä¸´æ—¶æ–‡ä»¶ï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*Gpu Memory Gate Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/gpu_memgate.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
wc -l /tmp/gpu_memgate.txt
```

> **âš ï¸ æ³¨æ„**ï¼šåç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/gpu_memgate.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—æˆ–å…¶ä»–ä¸´æ—¶æ–‡ä»¶ï¼ˆå¦‚ /tmp/eval_section.txtï¼‰ä¸­æœç´¢

**å‘½ä»¤**ï¼š
```bash
# åœ¨ GPU Memory Gate èŒƒå›´å†…æœç´¢å¤±è´¥é¡¹ï¼ˆåªåœ¨ Contrast éƒ¨åˆ†ï¼‰
grep -E "FAIL" /tmp/gpu_memgate.txt

# æˆ–è€…æŸ¥çœ‹å®Œæ•´çš„ Contrast éƒ¨åˆ†
grep "======.*Contrast" /tmp/gpu_memgate.txt -A 100
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
#### GPU Memory Gate åˆ†æ

| Plug | æŒ‡æ ‡ | æµ‹è¯•å€¼ | åŸºçº¿å€¼ | å¢é‡ | é˜ˆå€¼ | çŠ¶æ€ |
|------|------|--------|--------|------|------|------|
| DRIVING | PEAK | 9500 MB | 9308 MB | +191 MB | 379 MB | âŒ FAIL |
```

#### 4.7 MEMGATE_CPU åˆ†æ

> ğŸ“š è¯¦è§ `knowledge/resource-analysis.md`

**âš ï¸ æ‰§è¡Œå‰æ**ï¼šä»…åœ¨ Step 3 ç¡®è®¤ `Stage.MEMGATE_CPU` ä¸º **failed** æ—¶æ‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œå¦åˆ™ç›´æ¥è¾“å‡º "N/A"

**Step 4.7.0 æå– CPU Memory Gate æ—¥å¿—èŒƒå›´**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼Œç¦æ­¢è·³è¿‡æ­¤æ­¥éª¤ï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*Cpu Memory Gate Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/cpu_memgate.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
wc -l /tmp/cpu_memgate.txt
```

> **âš ï¸ æ³¨æ„**ï¼šåç»­æ‰€æœ‰æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/cpu_memgate.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢

**å‘½ä»¤**ï¼š
```bash
# åœ¨ CPU Memory Gate èŒƒå›´å†…æœç´¢å¤±è´¥é¡¹
grep -E "FAIL|è¶…å‡º" /tmp/cpu_memgate.txt
```

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
#### CPU Memory Gate åˆ†æ

| Plug | æŒ‡æ ‡ | æµ‹è¯•å€¼ | åŸºçº¿å€¼ | å¢é‡ | é˜ˆå€¼ | çŠ¶æ€ |
|-------------|------|--------|--------|------|------|------|
| DRIVING | PEAK | 4500 MB | 4200 MB | +300 MB | 200 MB | âŒ FAIL |
```

---

### ğŸ“‹ Step 5: EVALUATION æŒ‡æ ‡åˆ†æï¼ˆå¿…æŸ¥ï¼‰

**âš ï¸ æ— è®º EVALUATION æˆåŠŸä¸å¦ï¼Œéƒ½å¿…é¡»æ‰§è¡Œæ­¤æ­¥éª¤ï¼**

> **ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼š
> - **EVALUATION çš„ç›®æ ‡æ˜¯åˆ†æç²¾åº¦æŒ‡æ ‡**ï¼Œä¸æ˜¯æ£€æŸ¥ä»»åŠ¡æ˜¯å¦ crash
> - **å³ä½¿æœ‰ä»»åŠ¡ crashï¼Œä¹Ÿè¦åˆ†ææˆåŠŸä»»åŠ¡çš„ç²¾åº¦æ•°æ®**
> - ä»»åŠ¡ crash çš„åˆ†æå·²åœ¨ Step 2 å®Œæˆï¼ŒStep 5 åªå…³æ³¨ç²¾åº¦
> - EVALUATION Stage å¯èƒ½æ ‡è®°ä¸º successï¼ˆéƒ¨åˆ†ä»»åŠ¡æˆåŠŸå³å¯ï¼‰ï¼Œæ­¤æ—¶æ›´è¦ä»”ç»†åˆ†æç²¾åº¦æŒ‡æ ‡

> **ğŸš¨ å…³é”®è§„åˆ™**ï¼š
> 1. **EVALUATION æœ‰ä¸¥æ ¼çš„æ—¥å¿—è¾¹ç•Œ**ï¼šä» `"Evaluation Test Summary"` å¼€å§‹ï¼Œåˆ°ä¸‹ä¸€ä¸ª `Summary` ç»“æŸ
> 2. **ç¦æ­¢å…¨å±€æœç´¢**ï¼šStep 5.1-5.5 çš„æ‰€æœ‰æœç´¢å¿…é¡»é™å®šåœ¨ EVALUATION èŒƒå›´å†…
> 3. **å…¶ä»– Stage çš„æ•°æ®ä¸å±äº EVALUATION**ï¼šå¦‚ GPU Memory Gateã€CPU Monitor ç­‰èµ„æºç›‘æ§æ•°æ®å±äºå…¶ä»– Stage
> 4. **å¿…é¡»å…ˆæ‰§è¡Œ Step 5.0**ï¼šæå– EVALUATION æ—¥å¿—åˆ° `/tmp/eval_section.txt`ï¼Œç¦æ­¢è·³è¿‡æ­¤æ­¥éª¤

**Step 5.0 æå– EVALUATION æ—¥å¿—èŒƒå›´ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰**ï¼š

> **ğŸš¨ å¼ºåˆ¶è¦æ±‚**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ­¤æ­¥éª¤ï¼åç»­ Step 5.1-5.5 çš„æ‰€æœ‰æ“ä½œéƒ½åªèƒ½åœ¨ `/tmp/eval_section.txt` ä¸­è¿›è¡Œï¼

```bash
# ä¿é™©æ–¹æ³•ï¼šè‡ªåŠ¨è®¡ç®—èŒƒå›´
start=$(grep -n "======.*Evaluation Test Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log> > /tmp/eval_section.txt

# éªŒè¯æå–æ˜¯å¦æ­£ç¡®
echo "æå–è¡Œæ•°: $(wc -l < /tmp/eval_section.txt)"
head -3 /tmp/eval_section.txt  # åº”è¯¥ä»¥ "Evaluation Test Summary" å¼€å¤´
tail -3 /tmp/eval_section.txt  # åº”è¯¥åœ¨ä¸‹ä¸€ä¸ª Summary ä¹‹å‰ç»“æŸ
grep -c "Compare Tracking Metric" /tmp/eval_section.txt  # æ£€æŸ¥æ˜¯å¦åŒ…å«å¯¹æ¯”æ•°æ®
grep -c "xxxxxxxx.*xxxxxxxx" /tmp/eval_section.txt  # æ£€æŸ¥ç®—æ³•åœºæ™¯æ•°é‡
```

> **âš ï¸ é‡è¦**ï¼šä»¥ä¸‹æ‰€æœ‰ Step 5.1-5.5 çš„æœç´¢éƒ½å¿…é¡»åœ¨ `/tmp/eval_section.txt` ä¸­è¿›è¡Œï¼Œç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ã€`/tmp/performance.txt`ã€`/tmp/gpu_memgate.txt` ç­‰å…¶ä»–æ–‡ä»¶ä¸­æœç´¢ï¼

**âŒ å¸¸è§é”™è¯¯**ï¼š
```bash
# é”™è¯¯1ï¼šåœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢ EVALUATION æ•°æ®
grep "Compare Tracking Metric" /tmp/job_full.log  # âŒ

# é”™è¯¯2ï¼šä½¿ç”¨å…¶ä»– Stage çš„ä¸´æ—¶æ–‡ä»¶
grep "Tracker Eval" /tmp/performance.txt  # âŒ

# é”™è¯¯3ï¼šè·³è¿‡ Step 5.0 ç›´æ¥æœç´¢
grep "Avp Eval" <log>  # âŒ
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
```bash
# æ­¥éª¤1ï¼šæ‰§è¡Œ Step 5.0 æå– EVALUATION æ—¥å¿—
sed -n "${start},${end}p" <log> > /tmp/eval_section.txt

# æ­¥éª¤2ï¼šåœ¨æå–çš„æ–‡ä»¶ä¸­æœç´¢
grep "Compare Tracking Metric" /tmp/eval_section.txt  # âœ…
```

#### 5.1 è¯†åˆ«æ‰€æœ‰ç®—æ³•

**å‘½ä»¤**ï¼š
```bash
# âš ï¸ å¿…é¡»åœ¨ Step 5.0 æå–çš„ /tmp/eval_section.txt ä¸­æœç´¢
grep -E "Tracker.*Eval|Query_tracker.*Eval|Avp.*Eval" /tmp/eval_section.txt
```

**å¿…é¡»è®°å½•**ï¼š
```
â–¡ ç®—æ³•åˆ—è¡¨: tracker, query_tracker, avp
â–¡ ç®—æ³•æ€»æ•°: 3
```

#### 5.2 è¯†åˆ«æ¯ä¸ªç®—æ³•çš„æ•°æ®é›†

**å‘½ä»¤**ï¼š
```bash
# âš ï¸ å¿…é¡»åœ¨ Step 5.0 æå–çš„ /tmp/eval_section.txt ä¸­æœç´¢
grep -E "Tracker Eval|Query_tracker Eval|Avp Eval|--- benchmark" /tmp/eval_section.txt
```

**å¿…é¡»è®°å½•**ï¼š
```
â–¡ tracker: benchmark_v3, benchmark_radar
â–¡ query_tracker: benchmark_v3, benchmark_radar
â–¡ avp: benchmark_c01, benchmark_c01_uss
```

#### 5.3 åˆ†æ Tracker/Query_tracker æŒ‡æ ‡

**å‘½ä»¤**ï¼š
```bash
# âš ï¸ å¿…é¡»åœ¨ Step 5.0 æå–çš„ /tmp/eval_section.txt ä¸­æœç´¢
grep -E "Compare Tracking Metric" /tmp/eval_section.txt -A 25
```

**åˆ¤æ–­æ ‡å‡†**ï¼š

| æŒ‡æ ‡ | æ­£å¸¸æ³¢åŠ¨ | éœ€å…³æ³¨ âš ï¸ | ä¸¥é‡å›é€€ ğŸ”´ |
|------|----------|----------|------------|
| HOTA/DetA/AssA | Â±1.5 | Â±3.0 | >Â±5.0 |
| DetPr/DetRe | Â±1.0 | Â±2.0 | >Â±3.0 |
| HeadA | Â±1.5 | Â±3.0 | >Â±5.0 |
| IDSW | Â±20 | Â±50 | >Â±100 |

#### 5.4 åˆ†æ AVP æŒ‡æ ‡

**å‘½ä»¤**ï¼š
```bash
# âš ï¸ å¿…é¡»åœ¨ Step 5.0 æå–çš„ /tmp/eval_section.txt ä¸­æœç´¢
grep -E "parking data compare|æ€§èƒ½å‡æ— è¾ƒå¤§å¹…åº¦ä¸‹é™" /tmp/eval_section.txt -B 5 -A 80
```

**å¿«é€Ÿåˆ¤æ–­**ï¼šæ—¥å¿—å‡ºç° `æ€§èƒ½å‡æ— è¾ƒå¤§å¹…åº¦ä¸‹é™!` â†’ âœ… é€šè¿‡

#### 5.5 è¾“å‡ºç®—æ³•è¦†ç›–è¡¨

**å¿…é¡»è¾“å‡ºæ ¼å¼**ï¼š
```markdown
### Step 5: EVALUATION æŒ‡æ ‡åˆ†æ

> **è¯´æ˜**ï¼šæœ¬æ­¥éª¤åˆ†æçš„æ˜¯ç²¾åº¦æŒ‡æ ‡ï¼Œä¸å…³æ³¨ä»»åŠ¡ crashã€‚å³ä½¿æœ‰ä»»åŠ¡ crashï¼ŒæˆåŠŸä»»åŠ¡çš„ç²¾åº¦æ•°æ®ä»ç„¶æœ‰æ•ˆã€‚

#### ç®—æ³•è¦†ç›–

| ç®—æ³• | æ•°æ®é›† | çŠ¶æ€ | å¤‡æ³¨ |
|------|--------|------|------|
| tracker | benchmark_v3 | âœ… | æŒ‡æ ‡å˜åŒ–åœ¨æ­£å¸¸èŒƒå›´ |
| tracker | benchmark_radar | âœ… | æŒ‡æ ‡å˜åŒ–åœ¨æ­£å¸¸èŒƒå›´ |
| query_tracker | benchmark_v3 | ğŸ”´ | HeadA -28.64 (cone) |
| query_tracker | benchmark_radar | âš ï¸ | HeadA -4.55 (cone) |
| avp | benchmark_c01 | âœ… | æ€§èƒ½å‡æ— è¾ƒå¤§å¹…åº¦ä¸‹é™ |
| avp | benchmark_c01_uss | âœ… | æ€§èƒ½å‡æ— è¾ƒå¤§å¹…åº¦ä¸‹é™ |

#### éœ€å…³æ³¨çš„æŒ‡æ ‡ï¼ˆå¦‚æœ‰ï¼‰

| ç®—æ³• | æ•°æ®é›† | è§†è§’ | ç±»åˆ« | æŒ‡æ ‡ | å˜åŒ– | çŠ¶æ€ |
|------|--------|------|------|------|------|------|
| query_tracker | benchmark_v3 | FRONT | cone | HeadA | -28.64 | ğŸ”´ ä¸¥é‡å›é€€ |

#### æ€»ä½“è¯„ä¼°
- å…±æ£€æŸ¥ **3 ä¸ªç®—æ³•ã€6 ä¸ªæ•°æ®é›†**
- å‘ç° X ä¸ªéœ€å…³æ³¨é¡¹
```

---

### ğŸ“‹ Step 6: è¾“å‡ºè¯Šæ–­æŠ¥å‘Š

**ç›®çš„**ï¼šæ±‡æ€»æ‰€æœ‰åˆ†æç»“æœï¼Œè¾“å‡ºæ ‡å‡†åŒ–æŠ¥å‘Š

**âš ï¸ ä¸¥æ ¼æ ¼å¼è¦æ±‚**ï¼š
1. å¿…é¡»ä½¿ç”¨ä¸‹é¢çš„**å›ºå®šæ¨¡æ¿**ï¼Œä¸å¾—å¢åˆ æˆ–è°ƒæ•´ç« èŠ‚é¡ºåº
2. æ¯ä¸ªç« èŠ‚æ ‡é¢˜å¿…é¡»**å®Œå…¨ä¸€è‡´**ï¼ˆåŒ…æ‹¬ emoji å’Œç¼–å·ï¼‰
3. è¡¨æ ¼åˆ—æ•°å’Œåˆ—åå¿…é¡»**å®Œå…¨åŒ¹é…**æ¨¡æ¿
4. æ— å†…å®¹çš„ç« èŠ‚ä¿ç•™æ ‡é¢˜ï¼Œæ ‡æ³¨ "æ— " æˆ– "N/A"
5. ç¦æ­¢æ·»åŠ åˆ†éš”çº¿ `---` æˆ–é¢å¤–è¯´æ˜
6. **è¡¨æ ¼å•å…ƒæ ¼ä¸­ç¦æ­¢ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦**ï¼šé¿å… `::` `()` `{}` `[]` ç­‰ç¬¦å·ï¼Œç”¨ç©ºæ ¼æˆ–ç®€åŒ–è¡¨è¾¾æ›¿ä»£ï¼ˆå¦‚ `std::_Hashtable::count()` æ”¹ä¸º `Hashtable count`ï¼‰
7. **è¡¨æ ¼åçš„è¯´æ˜é¡¹ä½¿ç”¨åŠ ç²—æ ¼å¼**ï¼šä½¿ç”¨ `**è°ƒç”¨é“¾**:` è€Œé `- **è°ƒç”¨é“¾**:`ï¼Œé¿å…åˆ—è¡¨ç¬¦å·ä¸è¡¨æ ¼è§£æå†²çª

---

**ã€å›ºå®šæ¨¡æ¿ - ä¸¥æ ¼éµå®ˆã€‘**

```
## ğŸ”´ Module Bench è¯Šæ–­æŠ¥å‘Š

**Job**: [JOB_ID] | **ç»“è®º**: [ä¸€å¥è¯æ€»ç»“]

---

### 1ï¸âƒ£ å¤±è´¥æ¦‚è§ˆ

| é¡¹ç›® | å€¼ |
|------|------|
| ä»»åŠ¡æ€»æ•° | [N] |
| æˆåŠŸ | [N] |
| å¤±è´¥ | [N] |
| å¤±è´¥ Stage | [Stage.XXX / æ— ] |

---

### 2ï¸âƒ£ å¤±è´¥ä»»åŠ¡åˆ†æ

| TASK_ID | STATUS | æ•°æ®é›† | node_ret_codes | ç»“è®º |
|---------|--------|--------|----------------|------|
| [ID] | [STATUS] | [NAME] | [JSONæˆ–N/A] | [ç»“è®º] |

> æ— å¤±è´¥ä»»åŠ¡æ—¶å¡«å†™: æ— 

---

### 3ï¸âƒ£ Stage çŠ¶æ€

| Stage | çŠ¶æ€ |
|-------|------|
| THREAD_SANITIZER | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| FUNCTION_TEST | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| EVALUATION | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| PERFORMANCE | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| CPU_MONITOR | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| MEMGATE_GPU | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| MEMGATE_CPU | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |
| MEMCHECK_CPU | [ğŸ”´ failed / âœ… success / âšª æœªè¿è¡Œ] |

---

### 4ï¸âƒ£ å¤±è´¥ Stage è¯¦ç»†åˆ†æ

> **ğŸš¨ é‡è¦**ï¼šåªåˆ†æ 3ï¸âƒ£ ä¸­æ ‡è®°ä¸º ğŸ”´ failed çš„ Stageï¼Œå¯¹äº âœ… success æˆ– âšª æœªè¿è¡Œçš„ Stageï¼Œç›´æ¥è¾“å‡º "N/A"ï¼Œä¸è¦è¾“å‡ºä»»ä½•æ•°æ®è¡¨æ ¼ï¼

#### 4.1 FUNCTION_TEST åˆ†æ

> ä»… FUNCTION_TEST å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"

- **é”™è¯¯æ—¥å¿—**: [å…³é”®é”™è¯¯ä¿¡æ¯]
- **å¯èƒ½çš„åŸå› **: [ä¸€å¥è¯æè¿°]
- **ä¿®å¤å»ºè®®**: [å…·ä½“æ–¹æ³•]

#### 4.2 TSan åˆ†æ

> ä»… THREAD_SANITIZER å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"

| # | æ“ä½œ | çº¿ç¨‹ | å‡½æ•° | ä»£ç ä½ç½® |
|---|------|------|------|---------|
| 1 | è¯» | [Txx] | [func()] | [file.cc:line] |
| 1 | å†™ | [Txx] | [func()] | [file.cc:line] |

- **è°ƒç”¨é“¾**: [è¯»çº¿ç¨‹è°ƒç”¨é“¾] / [å†™çº¿ç¨‹è°ƒç”¨é“¾]
- **æ ¹å› **: [ä¸€å¥è¯æè¿°]
- **ä¿®å¤å»ºè®®**: [å…·ä½“æ–¹æ³•]

#### 4.3 Memcheck åˆ†æ

> ä»… MEMCHECK_CPU å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"

| é”™è¯¯ç±»å‹ | æ•°é‡ | æ¨¡å— | ä»£ç ä½ç½® |
|----------|------|------|---------|
| [ç±»å‹] | [N] | [module] | [file.cc:line] |

- **ä¿®å¤å»ºè®®**: [å…·ä½“æ–¹æ³•]

#### 4.4 Performance åˆ†æ

> ä»… PERFORMANCE å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"
>
> **ğŸš¨ å¿…é¡»ä¸¥æ ¼æŒ‰ä¸‰æ­¥æ³•ï¼ˆStep A â†’ B â†’ C â†’ Dï¼‰è¾“å‡ºï¼Œç¦æ­¢ä»…åˆ— NotPass è¡¨æ ¼ï¼**

##### Step A: Single Thread Eval NotPassï¼ˆçœŸæ­£å›é€€ï¼‰

| Mode | Group | å¤±è´¥å…ƒç´  | æµ‹è¯•å€¼ (ms) | åŸºçº¿å€¼ (ms) | ç»å¯¹å·®å€¼ | ç›¸å¯¹å·®å€¼ | é˜ˆå€¼ | çŠ¶æ€ |
|------|-------|----------|------------|------------|---------|---------|------|------|
| [MODE] | [GROUP] | [ELEMENT] | [TEST] | [BASE] | +X.XX ms | +X.XX% | [THR] | âŒ NotPass |

**å¤šçº¿ç¨‹ NotPass ä½†å•çº¿ç¨‹ Pass çš„ node**ï¼ˆå°†è¿›å…¥ Step B åˆ†æï¼‰ï¼š
- [node å]: å•çº¿ç¨‹ +X.XX ms (+X.XX%) â†’ Pass

##### Step B: èµ„æºç«äº‰åˆ†æ â€” [target_node]

**ç›®æ ‡ node æ—¶é—´çª—å£**ï¼ˆMulti Thread [MODE] Contrastï¼‰ï¼š
- Start = X.XX ms, End = X.XX ms
- Process = X.XX msï¼ˆbaseline = X.XX msï¼Œå·®å€¼ = +X.XX ms / +XX.XX%ï¼‰

**é‡å  node åˆ—è¡¨**ï¼š

| é‡å  Node | Start (ms) | End (ms) | Process æµ‹è¯• (ms) | Process åŸºçº¿ (ms) | Process å·®å€¼ | æ˜¯å¦æ˜¾è‘— |
|-----------|-----------|---------|-----------------|-----------------|-------------|---------|
| [NODE] | ... | ... | ... | ... | +/-X.XX ms (+/-X.XX%) | [â¬†ï¸/â¬‡ï¸/â¡ï¸] |

**GPU æ¨¡å‹åˆ†å¸ƒå˜åŒ–**ï¼ˆå¦‚æ¶‰åŠ GPU nodeï¼‰ï¼š

| æŒ‡æ ‡ | Testline | Baseline | å˜åŒ– |
|------|---------|---------|------|
| Process p50 | X.XX ms | X.XX ms | -X.XX ms |
| Process stdev | X.XX | X.XX | [æè¿°] |

**Step B ç»“è®º**: [å…·ä½“æè¿°ç«äº‰æ¥æºæˆ– GPU è°ƒåº¦å˜åŒ–]

##### Step C: æ–°å¢/åˆ é™¤ Node æ£€æŸ¥

**æ–°å¢ nodeï¼ˆX ä¸ªï¼‰**ï¼š

| æ–°å¢ Node | Start (ms) | End (ms) | Process (ms) | ä¸ç›®æ ‡ node é‡å ï¼Ÿ |
|-----------|-----------|---------|-------------|-------------------|
| [NODE] | ... | ... | ... | âœ…/âŒ [ç†ç”±] |

**åˆ é™¤ nodeï¼ˆX ä¸ªï¼‰**ï¼š[åˆ—è¡¨æˆ–"æ— "]

**Step C ç»“è®º**: [æ˜¯å¦æœ‰æ–°å¢ node å¯¼è‡´èµ„æºç«äº‰]

##### æœ€ç»ˆåˆ¤å®šæ±‡æ€»

| NotPass Node | å‡ºç°åœºæ™¯ | å•çº¿ç¨‹çŠ¶æ€ | åˆ†ç±» | åˆ¤å®šä¾æ® |
|-------------|---------|----------|------|---------|
| [NODE] | [åœºæ™¯] | âŒ/âœ… | çœŸæ­£å›é€€/èµ„æºç«äº‰/GPUè°ƒåº¦å˜åŒ–/æ–°å¢Nodeå½±å“ | [å…·ä½“è¯æ®] |

**ä¿®å¤å»ºè®®**ï¼ˆæŒ‰åˆ†ç±»ï¼‰:
- **çœŸæ­£å›é€€**: [å…·ä½“æ’æŸ¥æ–¹å‘]
- **èµ„æºç«äº‰/GPUè°ƒåº¦å˜åŒ–**: [å…·ä½“å»ºè®®]

#### 4.5 CPU Monitor åˆ†æ

> ä»… CPU_MONITOR å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"

| Plug | æŒ‡æ ‡ | æµ‹è¯•å€¼ | åŸºçº¿å€¼ | å¢é‡ | é˜ˆå€¼ | çŠ¶æ€ |
|-------------|------|--------|--------|------|------|------|
| [MODE] | [METRIC] | [VAL] | [BASE] | [DIFF] | [THR] | [âŒ/âœ…] |

#### 4.6 GPU Memory Gate åˆ†æ

> ä»… MEMGATE_GPU å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"

| Plug | æŒ‡æ ‡ | æµ‹è¯•å€¼ | åŸºçº¿å€¼ | å¢é‡ | é˜ˆå€¼ | çŠ¶æ€ |
|-------------|------|--------|--------|------|------|------|
| [MODE] | [METRIC] | [VAL] | [BASE] | [DIFF] | [THR] | [âŒ/âœ…] |

#### 4.6 CPU Memory Gate åˆ†æ

> ä»… MEMGATE_CPU å¤±è´¥æ—¶å¡«å†™ï¼Œå¦åˆ™æ ‡æ³¨ "N/A"

| Plug | æŒ‡æ ‡ | æµ‹è¯•å€¼ | åŸºçº¿å€¼ | å¢é‡ | é˜ˆå€¼ | çŠ¶æ€ |
|-------------|------|--------|--------|------|------|------|
| [MODE] | [METRIC] | [VAL] | [BASE] | [DIFF] | [THR] | [âŒ/âœ…] |

---

### 5ï¸âƒ£ EVALUATION åˆ†æ

> **è¯´æ˜**ï¼šæœ¬èŠ‚åˆ†æç²¾åº¦æŒ‡æ ‡ï¼Œä¸å…³æ³¨ä»»åŠ¡ crashï¼ˆcrash å·²åœ¨ 2ï¸âƒ£ å¤±è´¥ä»»åŠ¡åˆ†æä¸­è¯´æ˜ï¼‰

#### ç®—æ³•è¦†ç›–

| ç®—æ³• | æ•°æ®é›† | çŠ¶æ€ | å¤‡æ³¨ |
|------|--------|------|------|
| [NAME] | [DATASET] | [âœ…/âš ï¸/ğŸ”´] | [è¯´æ˜] |

#### éœ€å…³æ³¨æŒ‡æ ‡

| ç®—æ³• | æ•°æ®é›† | è§†è§’ | ç±»åˆ« | æŒ‡æ ‡ | å˜åŒ– | çŠ¶æ€ |
|------|--------|------|------|------|------|------|
| [NAME] | [DS] | [VIEW] | [CLASS] | [METRIC] | [CHANGE] | [âš ï¸/ğŸ”´] |

> æ— éœ€å…³æ³¨é¡¹æ—¶æ ‡æ³¨: æ— 

---

### 6ï¸âƒ£ å»ºè®®æ“ä½œ

1. [æ“ä½œ1]
2. [æ“ä½œ2]

---

ğŸ“ æ—¥å¿—: [å®Œæ•´ Job URL]
```

---

## ç¯å¢ƒé…ç½®

### GitLab æ—¥å¿—è·å–

**âš ï¸ æ³¨æ„ï¼šå¿…é¡»ä½¿ç”¨ `python3` æ‰§è¡Œè„šæœ¬**

```bash
# é»˜è®¤æ¨¡å¼ï¼šæå–é”™è¯¯ç›¸å…³å†…å®¹ + æœ€å500è¡Œ
python3 scripts/fetch_gitlab_log.py <job_url>

# å®Œæ•´æ—¥å¿—æ¨¡å¼
python3 scripts/fetch_gitlab_log.py <job_url> --full

# TSan æ¨¡å¼
python3 scripts/fetch_gitlab_log.py <job_url> --tsan
```

**ç¯å¢ƒè¦æ±‚**ï¼š
- `GITLAB_TOKEN`ï¼šGitLab Personal Access Token
- `GITLAB_URL`ï¼šGitLab å®ä¾‹åœ°å€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ code.deeproute.aiï¼‰

---

## çŸ¥è¯†åº“å‚è€ƒ

**âš ï¸ é‡è¦ï¼šåœ¨æ‰§è¡Œå¯¹åº”æ­¥éª¤å‰ï¼Œå¿…é¡»å…ˆé˜…è¯»ç›¸å…³çŸ¥è¯†åº“çš„å®Œæ•´å†…å®¹ï¼**

| æ–‡ä»¶ | å…³è”æ­¥éª¤ | å¿…è¯» | å†…å®¹ |
|------|---------|:----:|------|
| `knowledge/task-status-codes.md` | Step 2 | âœ… | TaskStatus çŠ¶æ€ç è¯¦è§£ã€è¿”å›ç å¯¹ç…§è¡¨ã€æƒ…å†µåˆ¤æ–­æµç¨‹ |
| `knowledge/tsan-analysis.md` | Step 4.1 | âœ… | ThreadSanitizer æ·±å…¥åˆ†ææµç¨‹ |
| `knowledge/memcheck-analysis.md` | Step 4.2 | âœ… | Memcheck å†…å­˜é—®é¢˜åˆ†ææŒ‡å— |
| `knowledge/performance-analysis.md` | Step 4.3 | âœ… | Performance æ€§èƒ½å›å½’åˆ†ææŒ‡å— |
| `knowledge/resource-analysis.md` | Step 4.4-4.6 | âœ… | CPU_MONITOR / MEMGATE_GPU / MEMGATE_CPU èµ„æºç›‘æ§åˆ†æ |
| `knowledge/stage-types.md` | Step 3 | ğŸ“– | Stage ç±»å‹è¯¦è§£ |
| `knowledge/typical-cases.md` | - | ğŸ“– | å…¸å‹æ¡ˆä¾‹è®°å½• |

**å›¾ä¾‹**ï¼šâœ… å¿…é¡»é˜…è¯» | ğŸ“– å»ºè®®å‚è€ƒ

---

## å…³é”®æ—¥å¿—æ¨¡å¼

**âš ï¸ æ—¥å¿—ç»“æ„**ï¼š
```
======================================== xxxx Summary ========================================
  ... xxxx stage çš„æ—¥å¿—ä¿¡æ¯ ...
======================================== yyyy Summary ========================================
  ... yyyy stage çš„æ—¥å¿—ä¿¡æ¯ ...
```

**é‡è¦æ¦‚å¿µ**ï¼š
- æ¯ä¸ª Stage çš„æ—¥å¿—èŒƒå›´ï¼šä» `"xxxx Summary"` å¼€å§‹ï¼Œåˆ°ä¸‹ä¸€ä¸ª `"yyyy Summary"` ç»“æŸ
- **æ—¥å¿—è¾¹ç•Œæ˜¯ä¸¥æ ¼çš„**ï¼šä¸åŒ Stage çš„æ•°æ®ä¸ä¼šæ··åœ¨ä¸€èµ·
- **æœç´¢æ—¶å¿…é¡»é™å®šèŒƒå›´**ï¼šå…ˆç”¨ `sed` æå–å•ä¸ª Stage çš„æ—¥å¿—åˆ°ç‹¬ç«‹æ–‡ä»¶ï¼Œå†åœ¨å…¶ä¸­æœç´¢
- **å¸¸è§é”™è¯¯**ï¼šåœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢å…³é”®è¯ï¼Œå¯¼è‡´æ··å…¥å…¶ä»– Stage çš„æ•°æ®

**ğŸš¨ å¼ºåˆ¶å·¥ä½œæµç¨‹**ï¼š
```
1. è·å–å®Œæ•´æ—¥å¿— â†’ /tmp/job_full.log
2. åˆ†æå“ªäº› Stage å¤±è´¥ (Step 3)
3. å¯¹æ¯ä¸ªå¤±è´¥çš„ Stageï¼š
   a. æå–è¯¥ Stage æ—¥å¿— â†’ /tmp/stage_name.txt  (Step X.0)
   b. éªŒè¯æå–æ˜¯å¦æ­£ç¡®
   c. åœ¨è¯¥ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢å’Œåˆ†æ (Step X.1, X.2, ...)
4. ç¦æ­¢è·³è¿‡æ­¥éª¤ 3a
5. ç¦æ­¢åœ¨å…¨å±€æ—¥å¿—ä¸­ç›´æ¥æœç´¢
6. ç¦æ­¢ä½¿ç”¨å…¶ä»– Stage çš„ä¸´æ—¶æ–‡ä»¶
```

### æŸ¥æ‰¾ Task Node Summary

**ä¿é™©æ–¹æ³•ï¼ˆæ¨èï¼‰**ï¼š
```bash
# Task Node Summary çš„ç»“æŸæ ‡è®°æ˜¯ "Deelooper Run Task Time"ï¼ˆä¸æ˜¯ "Summary"ï¼‰
start=$(grep -n "======.*Task Node Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Deelooper Run Task Time" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log_file> > /tmp/task_node.txt

# éªŒè¯æå–
echo "æå–è¡Œæ•°: $(wc -l < /tmp/task_node.txt)"
head -5 /tmp/task_node.txt
```

**å¿«é€ŸæŸ¥çœ‹ï¼ˆä¸æå–ï¼‰**ï¼š
```bash
# ç›´æ¥æŸ¥çœ‹å‰300è¡Œï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
grep "======.*Task Node Summary" <log_file> -A 300
```

### æŸ¥æ‰¾æ‰€æœ‰å¤±è´¥/é—®é¢˜ä»»åŠ¡

**æ¨èæ–¹æ³•**ï¼ˆåœ¨æå–çš„ Task Node Summary ä¸­æœç´¢ï¼‰ï¼š
```bash
# 1. å…ˆæå– Task Node Summaryï¼ˆè§ä¸Šä¸€èŠ‚ï¼‰
start=$(grep -n "======.*Task Node Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Deelooper Run Task Time" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log_file> > /tmp/task_node.txt

# 2. åœ¨æå–çš„èŒƒå›´å†…æœç´¢å¤±è´¥ä»»åŠ¡
grep -E "TaskStatus\." /tmp/task_node.txt | grep -v SUCCESS

# 3. æˆ–ç›´æ¥æœç´¢ç‰¹å®šå¤±è´¥ç±»å‹
grep -E "TaskStatus\.(FAILED|MODULE_CRASH|BAG_SELECT_INVALID|UNKNOW_DDL_CRASH|CATCH_THREAD_ISSUE|CATCH_MEM_ERROR)" /tmp/task_node.txt
```

**å¿«é€Ÿæ–¹æ³•**ï¼ˆç›´æ¥åœ¨å…¨å±€æ—¥å¿—æœç´¢ï¼Œä½†å¯èƒ½åŒ…å«å…¶ä»–ä½ç½®çš„çŠ¶æ€ï¼‰ï¼š
```bash
# æŸ¥æ‰¾æ‰€æœ‰é SUCCESS çš„ä»»åŠ¡
grep -E "TaskStatus\." <log_file> | grep -v SUCCESS
```

### æŸ¥æ‰¾ Stage Summary
```bash
# ä¿é™©æ–¹æ³•ï¼ˆç»“æŸæ ‡è®°å¯èƒ½æ˜¯ Performance Report æˆ– Pipeline Status æˆ–å…¶ä»– Reportï¼‰
start=$(grep -n "======.*Stage Summary Report" <log_file> | cut -d: -f1)

# æŸ¥æ‰¾ä¸‹ä¸€ä¸ª ====== åˆ†éš”çº¿ï¼ˆä»»æ„ Report/Summaryï¼‰
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*========================================" | head -1 | cut -d: -f1)
end=$((start + next - 1))
sed -n "${start},${end}p" <log_file> > /tmp/stage_summary.txt
```

### æå–å„ Stage æ—¥å¿—èŒƒå›´

**âš ï¸ é‡è¦**ï¼šå…ˆæå– Stage è¾¹ç•Œï¼Œå†åœ¨å…¶ä¸­æœç´¢ï¼Œé¿å…æ··å…¥å…¶ä»– Stage çš„æ•°æ®

**æ¨èæ–¹æ³•ï¼šä¿é™©æå–ï¼ˆé€šç”¨æ¨¡æ¿ï¼‰**
```bash
# é€šç”¨å‡½æ•°ï¼šæå–ä»»æ„ Stage
extract_stage() {
  local stage_pattern="$1"  # å¦‚ "Performance Test Summary"
  local output_file="$2"     # å¦‚ /tmp/performance.txt
  local log_file="$3"        # æºæ—¥å¿—æ–‡ä»¶
  
  start=$(grep -n "======.*${stage_pattern}" "$log_file" | cut -d: -f1)
  next=$(tail -n +$((start + 1)) "$log_file" | grep -n "======.*Summary" | head -1 | cut -d: -f1)
  end=$((start + next - 1))
  sed -n "${start},${end}p" "$log_file" > "$output_file"
  echo "âœ“ æå– ${stage_pattern}: $(wc -l < $output_file) è¡Œ"
}

# ä½¿ç”¨ç¤ºä¾‹
extract_stage "Function Test Summary" /tmp/function_test.txt <log_file>
extract_stage "Performance Test Summary" /tmp/performance.txt <log_file>
extract_stage "Thread Sanitizer Summary" /tmp/tsan.txt <log_file>
extract_stage "Evaluation Test Summary" /tmp/eval.txt <log_file>
extract_stage "Memchek Cpu Test Summary" /tmp/memcheck.txt <log_file>
extract_stage "CPU Monitor Summary" /tmp/cpu_monitor.txt <log_file>
extract_stage "Gpu Memory Gate Summary" /tmp/gpu_memgate.txt <log_file>
extract_stage "Cpu Memory Gate Summary" /tmp/cpu_memgate.txt <log_file>
```

**æˆ–å•ç‹¬æå–ï¼ˆæ¨èç”¨äºè¯Šæ–­æµç¨‹ï¼‰**
```bash
# Function Test
start=$(grep -n "======.*Function Test Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log_file> > /tmp/function_test.txt

# Performance Test
start=$(grep -n "======.*Performance Test Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log_file> > /tmp/performance.txt

# Thread Sanitizer
start=$(grep -n "======.*Thread Sanitizer Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log_file> > /tmp/tsan.txt

# Evaluation
start=$(grep -n "======.*Evaluation Test Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log_file> > /tmp/eval.txt
```

### åœ¨æå–çš„èŒƒå›´å†…æœç´¢

```bash
# åœ¨ç‰¹å®š Stage ä¸­æœç´¢å…³é”®è¯
grep "å…³é”®è¯" /tmp/stage_name.txt

# ç¤ºä¾‹ï¼šåœ¨ TSan æ—¥å¿—ä¸­æœç´¢ data race
grep "data race" /tmp/tsan.txt -A 40

# ç¤ºä¾‹ï¼šåœ¨ EVALUATION ä¸­æœç´¢ tracker æŒ‡æ ‡
grep "Compare Tracking Metric" /tmp/eval.txt -A 25
```

### æŸ¥æ‰¾ Data Race è¯¦æƒ…
```bash
# æ¨èï¼šå…ˆæå–å®Œæ•´çš„ Thread Sanitizer Stageï¼ˆä½¿ç”¨ä¿é™©æ–¹æ³•ï¼‰
start=$(grep -n "======.*Thread Sanitizer Summary" <log_file> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log_file> | grep -n "======.*Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log_file> > /tmp/tsan.txt

# åœ¨æå–çš„èŒƒå›´å†…æœç´¢ data race
grep -A 80 "WARNING: ThreadSanitizer: data race" /tmp/tsan.txt

# æœç´¢å†™æ“ä½œå †æ ˆ
grep -A 40 "Previous write" /tmp/tsan.txt
```

### ä½¿ç”¨è„šæœ¬æå– TSan è¯¦æƒ…
```bash
python3 scripts/fetch_gitlab_log.py <job_url> --tsan
```

---

## âš ï¸ å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•

### âŒ é”™è¯¯ 1ï¼šæ··æ·†ä¸åŒ Stage çš„æ•°æ®

**ç°è±¡**ï¼š
- æŠŠ GPU Memory Gate çš„æ•°æ®æ”¾å…¥ EVALUATION åˆ†æ
- æŠŠ CPU Monitor çš„æ•°æ®æ”¾å…¥ Performance åˆ†æ
- åœ¨ Performance çš„ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢ EVALUATION æ•°æ®

**æ ¹æœ¬åŸå› **ï¼š
- åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢å…³é”®è¯ï¼Œæœªé™å®š Stage è¾¹ç•Œ
- ä½¿ç”¨äº†å…¶ä»– Stage æå–çš„ä¸´æ—¶æ–‡ä»¶
- è·³è¿‡äº† Step X.0 çš„æ—¥å¿—æå–æ­¥éª¤

**æ­£ç¡®åšæ³•**ï¼š
```bash
# âŒ é”™è¯¯1ï¼šå…¨å±€æœç´¢
grep "GPU Memory Gate" /tmp/job_full.log

# âŒ é”™è¯¯2ï¼šä½¿ç”¨é”™è¯¯çš„ä¸´æ—¶æ–‡ä»¶
grep "Tracker Eval" /tmp/performance.txt  # Tracker å±äº EVALUATIONï¼Œä¸å±äº PERFORMANCE

# âŒ é”™è¯¯3ï¼šä½¿ç”¨å…¶ä»– Stage çš„ä¸´æ—¶æ–‡ä»¶
grep "FAIL" /tmp/eval_section.txt  # EVALUATION ä¸­ä¸ä¼šæœ‰ FAIL æ ‡è®°ï¼ŒFAIL æ˜¯ CPU Monitor çš„

# âœ… æ­£ç¡®ï¼šæ¯ä¸ª Stage å•ç‹¬æå–ï¼Œå•ç‹¬æœç´¢
# æ­¥éª¤1ï¼šæå– EVALUATION Stage
start=$(grep -n "Evaluation Test Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log> > /tmp/eval.txt

# æ­¥éª¤2ï¼šåªåœ¨ EVALUATION ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢ EVALUATION æ•°æ®
grep "Tracker Eval" /tmp/eval.txt  # âœ…

# æ­¥éª¤3ï¼šå¦‚æœè¦åˆ†æ Performanceï¼Œéœ€è¦é‡æ–°æå– Performance Stage
start=$(grep -n "Performance Test Summary" <log> | cut -d: -f1)
next=$(tail -n +$((start + 1)) <log> | grep -n "Summary" | head -1 | cut -d: -f1)
sed -n "${start},$((start + next - 1))p" <log> > /tmp/performance.txt

# æ­¥éª¤4ï¼šåªåœ¨ Performance ä¸´æ—¶æ–‡ä»¶ä¸­æœç´¢ Performance æ•°æ®
grep "NotPass" /tmp/performance.txt  # âœ…
```

### âŒ é”™è¯¯ 2ï¼šè·³è¿‡ Step X.0 çš„è¾¹ç•Œæå–

**ç°è±¡**ï¼š
- ç›´æ¥æ‰§è¡Œ Step 5.1-5.5ï¼Œæœªå…ˆæ‰§è¡Œ Step 5.0
- ç›´æ¥æ‰§è¡Œ Step 4.4.1ï¼Œæœªå…ˆæ‰§è¡Œ Step 4.4.0
- æœç´¢ç»“æœåŒ…å«äº†ä¸å±äºè¯¥ Stage çš„æ•°æ®
- æ··å…¥äº†å…¶ä»– Stage çš„å†…å®¹

**æ­£ç¡®åšæ³•**ï¼š
- **å¿…é¡»å…ˆæ‰§è¡Œ Step X.0**ï¼šæå–è¯¥ Stage çš„å®Œæ•´æ—¥å¿—èŒƒå›´åˆ°ç‹¬ç«‹çš„ä¸´æ—¶æ–‡ä»¶
- åç»­æ‰€æœ‰æœç´¢éƒ½åœ¨æå–å‡ºçš„æ–‡ä»¶ä¸­è¿›è¡Œ
- æ¯ä¸ª Stage ä½¿ç”¨ä¸åŒçš„ä¸´æ—¶æ–‡ä»¶åï¼ˆå¦‚ `/tmp/performance.txt`ã€`/tmp/eval_section.txt`ã€`/tmp/cpu_monitor.txt`ï¼‰
- **ç¦æ­¢è·³è¿‡ Step X.0**ï¼Œå³ä½¿ä½ è®¤ä¸ºå¯ä»¥ç›´æ¥åœ¨å…¨å±€æ—¥å¿—ä¸­æœç´¢

**æ£€æŸ¥æ¸…å•**ï¼š
```bash
# åœ¨æ‰§è¡Œä»»ä½• Step 4.x æˆ– Step 5.x ä¹‹å‰ï¼Œå…ˆç¡®è®¤ï¼š
ls -lh /tmp/performance.txt      # Performance åˆ†æç”¨
ls -lh /tmp/eval_section.txt     # EVALUATION åˆ†æç”¨
ls -lh /tmp/cpu_monitor.txt      # CPU Monitor åˆ†æç”¨
ls -lh /tmp/gpu_memgate.txt      # GPU Memory Gate åˆ†æç”¨
ls -lh /tmp/cpu_memgate.txt      # CPU Memory Gate åˆ†æç”¨
ls -lh /tmp/tsan.txt             # Thread Sanitizer åˆ†æç”¨
ls -lh /tmp/memcheck.txt         # Memcheck åˆ†æç”¨
ls -lh /tmp/function_test.txt    # Function Test åˆ†æç”¨
```

### âŒ é”™è¯¯ 3ï¼šæœªéªŒè¯æå–çš„æ—¥å¿—è¾¹ç•Œ

**ç°è±¡**ï¼š
- æå–çš„æ—¥å¿—åŒ…å«äº†ä¸‹ä¸€ä¸ª Stage çš„å†…å®¹
- æå–çš„æ—¥å¿—ä¸å®Œæ•´ï¼Œç¼ºå°‘éƒ¨åˆ†æ•°æ®

**æ­£ç¡®åšæ³•**ï¼š
```bash
# æå–ååŠ¡å¿…éªŒè¯
echo "æå–è¡Œæ•°: $(wc -l < /tmp/stage_name.txt)"
head -5 /tmp/stage_name.txt  # æ£€æŸ¥å¼€å¤´æ˜¯å¦æ­£ç¡®
tail -5 /tmp/stage_name.txt  # æ£€æŸ¥ç»“å°¾æ˜¯å¦åœ¨ä¸‹ä¸€ä¸ª Summary ä¹‹å‰

# æœç´¢æ—¶åŠ ä¸Š -B 5ï¼ŒæŸ¥çœ‹å‰5è¡Œç¡®è®¤å±äºå“ªä¸ª Summary
grep -B 5 "å…³é”®è¯" /tmp/stage_name.txt
```

### âš ï¸ è®°ä½ï¼šæ¯ä¸ª Stage ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶

| Stage | ä¸´æ—¶æ–‡ä»¶ | Step X.0 æå–å‘½ä»¤å…³é”®è¯ |
|-------|----------|----------------------|
| Performance | `/tmp/performance.txt` | `Performance Test Summary` |
| EVALUATION | `/tmp/eval_section.txt` | `Evaluation Test Summary` |
| CPU Monitor | `/tmp/cpu_monitor.txt` | `CPU Monitor Summary` |
| GPU Memory Gate | `/tmp/gpu_memgate.txt` | `Gpu Memory Gate Summary` |
| CPU Memory Gate | `/tmp/cpu_memgate.txt` | `Cpu Memory Gate Summary` |
| Thread Sanitizer | `/tmp/tsan.txt` | `Thread Sanitizer Summary` |
| Memcheck | `/tmp/memcheck.txt` | `Memchek Cpu Test Summary` |
| Function Test | `/tmp/function_test.txt` | `Function Test Summary` |

**ç¦æ­¢äº¤å‰ä½¿ç”¨**ï¼šä¸è¦åœ¨ `/tmp/eval_section.txt` ä¸­æœç´¢ Performance æ•°æ®ï¼Œä¸è¦åœ¨ `/tmp/performance.txt` ä¸­æœç´¢ EVALUATION æ•°æ®ï¼

---

## å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ

### Performance å¤±è´¥

| åŸå›  | éªŒè¯æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| ä»£ç æ€§èƒ½å›å½’ | æ£€æŸ¥ç›¸å…³æ¨¡å—ä»£ç å˜æ›´ | ä¼˜åŒ–ä»£ç æˆ–å›æ»š |
| æµ‹è¯•ç¯å¢ƒæ³¢åŠ¨ | é‡è·‘ç¡®è®¤æ˜¯å¦å¤ç° | å¦‚ä¸ç¨³å®šåˆ™å¿½ç•¥ |
| Baseline ç‰ˆæœ¬å·®å¼‚ | å¯¹æ¯” driver ç‰ˆæœ¬ | æ›´æ–° baseline |

### GPU Memory å¤±è´¥

| åŸå›  | éªŒè¯æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| æ–°å¢æ¨¡å‹/ç½‘ç»œå±‚ | æ£€æŸ¥ NN ç›¸å…³å˜æ›´ | ä¼˜åŒ–æ˜¾å­˜ä½¿ç”¨ |
| å†…å­˜æ³„æ¼ | å¤šæ¬¡è¿è¡Œè§‚å¯Ÿå¢é•¿ | ä¿®å¤æ³„æ¼ç‚¹ |
| Batch size å¢å¤§ | æ£€æŸ¥é…ç½®å˜æ›´ | è°ƒæ•´ batch size |

### Evaluation å¤±è´¥

| åŸå›  | éªŒè¯æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| ç®—æ³•ç²¾åº¦ä¸‹é™ | å¯¹æ¯” baseline ç»“æœ | æ£€æŸ¥ç®—æ³•å˜æ›´ |
| æ•°æ®é›†é—®é¢˜ | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ | æ›´æ–°æ•°æ®é›† |
| é˜ˆå€¼è®¾ç½®ä¸åˆç† | æŸ¥çœ‹å†å²æ•°æ®æ³¢åŠ¨ | è°ƒæ•´é˜ˆå€¼ |

### Thread Sanitizer å¤±è´¥

| åŸå›  | éªŒè¯æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| Protobuf å¹¶å‘è¯»å†™ | æŸ¥çœ‹ TSan å †æ ˆä¸­çš„ pb ç±» | æ·»åŠ  mutex ä¿æŠ¤å…±äº« protobuf å¯¹è±¡ |
| å…±äº«å˜é‡æ— é”ä¿æŠ¤ | æŸ¥çœ‹ç«äº‰å˜é‡ç±»å‹ | ä½¿ç”¨ std::mutex æˆ– std::atomic |
| å›è°ƒå‡½æ•°å¹¶å‘è®¿é—® | åˆ†æè¯»å†™çº¿ç¨‹çš„è°ƒç”¨é“¾ | åœ¨å›è°ƒä¸­åŠ é”æˆ–ä½¿ç”¨ copy-on-read |
| å®¹å™¨å¹¶å‘ä¿®æ”¹ | æ£€æŸ¥ vector/map ç­‰å®¹å™¨æ“ä½œ | ä½¿ç”¨çº¿ç¨‹å®‰å…¨å®¹å™¨æˆ–åŠ é” |

---

## æŒç»­æ”¹è¿›

éšç€ä½¿ç”¨æ­¤ skill è¯Šæ–­æ›´å¤šæ¡ˆä¾‹ï¼Œåº”è¯¥ï¼š
- è¡¥å……æ–°çš„å¤±è´¥æ¨¡å¼åˆ°æœ¬æ–‡æ¡£
- æ›´æ–°å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ
- æ·»åŠ å…¸å‹æ¡ˆä¾‹åˆ° `knowledge/` ç›®å½•

